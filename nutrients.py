import streamlit as st
import pandas as pd
import random
from pulp import *

# рЃАрЃљрЃЎрЃЋрЃћрЃЉрЃў рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃўрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў (рЃњрЃљрЃцрЃљрЃарЃЌрЃЮрЃћрЃЉрЃБрЃџрЃў рЃЎрЃљрЃџрЃЮрЃарЃўрЃБрЃџрЃЮрЃЉрЃўрЃЌ рЃЊрЃљ рЃЏрЃћрЃбрЃў рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃўрЃЌ)
products_data = {
    'рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў': [
        'рЃАрЃљрЃЦрЃЮрЃюрЃџрЃўрЃА рЃ«рЃЮрЃарЃфрЃў (рЃЏрЃГрЃџрЃћ)', 'рЃдрЃЮрЃарЃўрЃА рЃдрЃЋрЃўрЃФрЃџрЃў', 'рЃЦрЃљрЃЌрЃЏрЃўрЃА рЃЏрЃЎрЃћрЃарЃЊрЃў', 'рЃЦрЃљрЃЌрЃЏрЃўрЃА рЃдрЃЋрЃўрЃФрЃџрЃў', 'рЃўрЃюрЃЊрЃљрЃБрЃарЃўрЃА рЃ«рЃЮрЃарЃфрЃў', 'рЃфрЃ«рЃЋрЃарЃўрЃА рЃ«рЃЮрЃарЃфрЃў', 'рЃ«рЃЉрЃЮрЃА рЃ«рЃЮрЃарЃфрЃў',
        'рЃЮрЃарЃљрЃњрЃБрЃџрЃў (рЃЋрЃћрЃџрЃБрЃарЃў)', 'рЃЌрЃўрЃюрЃБрЃАрЃў (рЃЊрЃљрЃЎрЃЮрЃюрЃАрЃћрЃарЃЋрЃћрЃЉрЃБрЃџрЃў, рЃгрЃДрЃљрЃџрЃерЃў)', 'рЃАрЃљрЃарЃЊрЃўрЃюрЃў (рЃќрЃћрЃЌрЃерЃў, рЃФрЃЋрЃџрЃћрЃЉрЃўрЃЌ)', 'рЃЎрЃарЃћрЃЋрЃћрЃбрЃћрЃЉрЃў', 'рЃЏрЃўрЃЊрЃўрЃћрЃЉрЃў', 'рЃќрЃдрЃЋрЃўрЃА рЃЎрЃљрЃџрЃЏрЃљрЃ«рЃў', 'рЃЋрЃўрЃарЃЌрЃћрЃЋрЃќрЃљ', 'рЃАрЃЎрЃБрЃЏрЃЉрЃарЃўрЃљ',
        'рЃўрЃАрЃърЃљрЃюрЃљрЃ«рЃў', 'рЃЉрЃарЃЮрЃЎрЃЮрЃџрЃў', 'рЃАрЃбрЃљрЃцрЃўрЃџрЃЮ', 'рЃбрЃЎрЃЉрЃўрЃџрЃў рЃЎрЃљрЃарЃбрЃЮрЃцрЃўрЃџрЃў', 'рЃЎрЃЮрЃЏрЃЉрЃЮрЃАрЃбрЃЮ', 'рЃгрЃўрЃЌрЃћрЃџрЃў рЃЉрЃБрЃџрЃњрЃљрЃарЃБрЃџрЃў рЃгрЃўрЃгрЃљрЃЎрЃљ', 'рЃгрЃўрЃЌрЃћрЃџрЃў рЃЎрЃЮрЃЏрЃЉрЃЮрЃАрЃбрЃЮ', 'рЃЎрЃљрЃџрЃћ', 'рЃЉрЃарЃўрЃБрЃАрЃћрЃџрЃўрЃА рЃЎрЃЮрЃЏрЃЉрЃЮрЃАрЃбрЃЮ', 'рЃърЃЮрЃарЃбрЃЮрЃЉрЃћрЃџрЃЮ рЃАрЃЮрЃЎрЃЮ', 'рЃЉрЃљрЃарЃЊрЃљ', 'рЃЎрЃљрЃЏрЃљ', 'рЃЮрЃ«рЃарЃљрЃ«рЃБрЃерЃў', 'рЃюрЃўрЃЮрЃарЃў', 'рЃ»рЃљрЃюрЃ»рЃљрЃцрЃўрЃџрЃў', 'рЃЏрЃгрЃЋрЃљрЃюрЃћ рЃџрЃЮрЃЉрЃўрЃЮ',
        'рЃљрЃЋрЃЮрЃЎрЃљрЃЊрЃЮ', 'рЃЉрЃљрЃюрЃљрЃюрЃў', 'рЃцрЃЮрЃарЃЌрЃЮрЃ«рЃљрЃџрЃў', 'рЃЎрЃўрЃЋрЃў', 'рЃЏрЃљрЃарЃгрЃДрЃЋрЃў', 'рЃЏрЃЮрЃфрЃЋрЃў', 'рЃЋрЃљрЃерЃџрЃў', 'рЃџрЃўрЃЏрЃЮрЃюрЃў', 'рЃњрЃарЃћрЃўрЃърЃцрЃарЃБрЃбрЃў', 'рЃ«рЃЏрЃћрЃџрЃў рЃњрЃљрЃарЃњрЃљрЃарЃў',
        'рЃЎрЃљрЃарЃљрЃЦрЃў', 'рЃарЃФрЃћ (рЃЏрЃЌрЃџрЃўрЃљрЃюрЃў)', 'рЃўрЃЮрЃњрЃБрЃарЃбрЃў (рЃЉрЃћрЃарЃФрЃюрЃБрЃџрЃў)', 'рЃДрЃЋрЃћрЃџрЃў (рЃЕрЃћрЃЊрЃљрЃарЃў)', 'рЃЎрЃЋрЃћрЃарЃфрЃ«рЃў', 'рЃ«рЃљрЃГрЃЮ', 'рЃФрЃарЃЮрЃ«рЃўрЃА рЃарЃФрЃћ (D рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃўрЃЌ рЃњрЃљрЃЏрЃЊрЃўрЃЊрЃарЃћрЃЉрЃБрЃџрЃў)',
        'рЃерЃљрЃЋрЃў рЃџрЃЮрЃЉрЃўрЃЮ', 'рЃЮрЃАрЃърЃў', 'рЃгрЃўрЃгрЃўрЃЉрЃБрЃарЃљ', 'рЃДрЃљрЃЋрЃўрЃАрЃцрЃћрЃарЃў рЃЉрЃарЃўрЃюрЃ»рЃў', 'рЃЎрЃўрЃюрЃЮрЃљ', 'рЃерЃЋрЃарЃўрЃљ', 'рЃЌрЃћрЃЌрЃарЃў рЃџрЃЮрЃЉрЃўрЃЮ',
        'рЃюрЃБрЃерЃў', 'рЃюрЃўрЃњрЃЮрЃќрЃў', 'рЃЕрЃўрЃљрЃА рЃЌрЃћрЃАрЃџрЃў', 'рЃЏрЃќрЃћрЃАрЃБрЃЏрЃќрЃўрЃарЃўрЃА рЃЌрЃћрЃАрЃџрЃў', 'рЃњрЃЮрЃњрЃарЃўрЃА рЃЌрЃћрЃАрЃџрЃў', 'рЃЎрЃћрЃерЃўрЃБ', 'рЃцрЃўрЃАрЃбрЃљ', 'рЃЉрЃарЃљрЃќрЃўрЃџрЃўрЃБрЃарЃў рЃЎрЃљрЃЎрЃљрЃџрЃў', 'рЃцрЃўрЃГрЃЋрЃўрЃА рЃЎрЃљрЃЎрЃљрЃџрЃў',
        'рЃАрЃърЃўрЃарЃБрЃџрЃўрЃюрЃљ', 'рЃЦрЃџрЃЮрЃарЃћрЃџрЃљ', 'рЃАрЃЮрЃўрЃЮрЃА рЃарЃФрЃћ (рЃњрЃљрЃЏрЃљрЃњрЃарЃћрЃЉрЃБрЃџрЃў)', 'рЃбрЃЮрЃцрЃБ', 'рЃерЃљрЃЋрЃў рЃерЃЮрЃЎрЃЮрЃџрЃљрЃЊрЃў (70%+ рЃЎрЃљрЃЎрЃљрЃЮ)', 'рЃАрЃљрЃцрЃБрЃљрЃарЃўрЃА рЃћрЃЦрЃАрЃбрЃарЃљрЃЦрЃбрЃў', 'рЃЦрЃљрЃбрЃЮ', 'рЃЏрЃўрЃгрЃўрЃАрЃЌрЃ«рЃўрЃџрЃўрЃА рЃЎрЃљрЃарЃљрЃЦрЃў', 'рЃЦрЃЮрЃЦрЃЮрЃАрЃўрЃА рЃарЃФрЃћ', 'рЃЌрЃћрЃЋрЃќрЃўрЃА рЃЦрЃЮрЃюрЃў (рЃЎрЃЮрЃЊрЃўрЃА)', 'рЃерЃљрЃЏрЃърЃўрЃюрЃўрЃЮрЃюрЃў (D рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃўрЃЌ рЃњрЃљрЃЏрЃЊрЃўрЃЊрЃарЃћрЃЉрЃБрЃџрЃў)',
        # рЃљрЃ«рЃљрЃџрЃў рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў рЃЊрЃљ рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃћрЃЉрЃў
        'рЃЏрЃЌрЃџрЃўрЃљрЃюрЃў рЃ«рЃЮрЃарЃЉрЃџрЃўрЃА рЃърЃБрЃарЃў', 'рЃерЃЋрЃарЃўрЃўрЃА рЃцрЃљрЃюрЃбрЃћрЃџрЃў', 'рЃДрЃљрЃЋрЃўрЃАрЃцрЃћрЃарЃў рЃЉрЃарЃўрЃюрЃ»рЃўрЃА рЃЏрЃљрЃЎрЃљрЃарЃЮрЃюрЃў', 'рЃбрЃЎрЃЉрЃўрЃџрЃў рЃАрЃўрЃЏрЃўрЃюрЃЊрЃў',
        'рЃќрЃћрЃўрЃЌрЃБрЃюрЃўрЃА рЃќрЃћрЃЌрЃў', 'рЃЦрЃЮрЃЦрЃЮрЃАрЃўрЃА рЃќрЃћрЃЌрЃў', 'рЃАрЃћрЃџрЃўрЃА рЃЌрЃћрЃАрЃџрЃўрЃА рЃќрЃћрЃЌрЃў',
        'рЃЦрЃљрЃЌрЃЏрЃўрЃА рЃЉрЃљрЃарЃЎрЃљрЃџрЃў', 'рЃАрЃљрЃЦрЃЮрЃюрЃџрЃўрЃА рЃдрЃЋрЃўрЃФрЃџрЃў', 'рЃўрЃюрЃЊрЃљрЃБрЃарЃўрЃА рЃдрЃЋрЃўрЃФрЃџрЃў',
        'рЃЎрЃЋрЃћрЃарЃфрЃ«рЃўрЃА рЃњрЃБрЃџрЃў', 'рЃЎрЃЋрЃћрЃарЃфрЃ«рЃўрЃА рЃфрЃўрЃџрЃљ',
        'рЃгрЃўрЃЌрЃћрЃџрЃў рЃЮрЃАрЃърЃў', 'рЃгрЃўрЃгрЃўрЃџрЃљ (Chickpeas)',
        'рЃЉрЃарЃЮрЃЎрЃЮрЃџрЃў (рЃЏрЃЮрЃ«рЃљрЃарЃерЃБрЃџрЃў)', 'рЃАрЃЮрЃЎрЃЮ (рЃЌрЃћрЃЌрЃарЃў)', 'рЃърЃЮрЃЏрЃўрЃЊрЃЮрЃарЃў', 'рЃЎрЃўрЃбрЃарЃў', 'рЃЉрЃљрЃЊрЃарЃўрЃ»рЃљрЃюрЃў',
        'рЃЏрЃљрЃДрЃЋрЃљрЃџрЃў', 'рЃЪрЃЮрЃџрЃЮ', 'рЃљрЃбрЃљрЃЏрЃў', 'рЃЦрЃџрЃўрЃљрЃЋрЃў', 'рЃљрЃџрЃБрЃЉрЃљрЃџрЃў',
        'рЃцрЃћрЃбрЃЋрЃў', 'рЃЦрЃћрЃарЃў', 'рЃљрЃЏрЃљрЃарЃљрЃюрЃбрЃў',
        'рЃЏрЃЊрЃЮрЃњрЃЋрЃўрЃА рЃЏрЃгрЃЋрЃљрЃюрЃўрЃџрЃў', 'рЃбрЃБрЃарЃюрЃўрЃърЃўрЃА рЃЏрЃгрЃЋрЃљрЃюрЃўрЃџрЃў', 'рЃарЃБрЃЎрЃЮрЃџрЃљ',
        'рЃарЃФрЃћ (рЃюрЃљрЃ«рЃћрЃЋрЃарЃљрЃЊ рЃБрЃфрЃ«рЃўрЃЏрЃЮ)', 'рЃарЃўрЃЎрЃЮрЃбрЃљ рЃДрЃЋрЃћрЃџрЃў', 'рЃърЃљрЃарЃЏрЃћрЃќрЃљрЃюрЃў', 'рЃЌрЃ«рЃўрЃА рЃДрЃЋрЃћрЃџрЃў'
    ],
    'рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ': [
        'рЃ«рЃЮрЃарЃфрЃў', 'рЃдрЃЋрЃўрЃФрЃџрЃў', 'рЃ«рЃЮрЃарЃфрЃў', 'рЃдрЃЋрЃўрЃФрЃџрЃў', 'рЃ«рЃЮрЃарЃфрЃў', 'рЃ«рЃЮрЃарЃфрЃў', 'рЃ«рЃЮрЃарЃфрЃў',
        'рЃЌрЃћрЃЋрЃќрЃў', 'рЃЌрЃћрЃЋрЃќрЃў', 'рЃЌрЃћрЃЋрЃќрЃў', 'рЃќрЃдрЃЋрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў', 'рЃќрЃдрЃЋрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў', 'рЃЌрЃћрЃЋрЃќрЃў', 'рЃЌрЃћрЃЋрЃќрЃў', 'рЃЌрЃћрЃЋрЃќрЃў',
        'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃАрЃЮрЃЎрЃЮ', 'рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў', 'рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў',
        'рЃ«рЃўрЃџрЃў', 'рЃ«рЃўрЃџрЃў', 'рЃ«рЃўрЃџрЃў', 'рЃ«рЃўрЃџрЃў', 'рЃ«рЃўрЃџрЃў', 'рЃ«рЃўрЃџрЃў', 'рЃ«рЃўрЃџрЃў', 'рЃ«рЃўрЃџрЃў', 'рЃ«рЃўрЃџрЃў', 'рЃ«рЃўрЃџрЃў',
        'рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў', 'рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў', 'рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў', 'рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў', 'рЃЎрЃЋрЃћрЃарЃфрЃ«рЃў', 'рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў', 'рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў',
        'рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў', 'рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў', 'рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃБрЃџрЃў', 'рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃБрЃџрЃў', 'рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃБрЃџрЃў', 'рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃБрЃџрЃў', 'рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў',
        'рЃЎрЃљрЃЎрЃљрЃџрЃў рЃЊрЃљ рЃЌрЃћрЃАрЃџрЃў', 'рЃЎрЃљрЃЎрЃљрЃџрЃў рЃЊрЃљ рЃЌрЃћрЃАрЃџрЃў', 'рЃЎрЃљрЃЎрЃљрЃџрЃў рЃЊрЃљ рЃЌрЃћрЃАрЃџрЃў', 'рЃЎрЃљрЃЎрЃљрЃџрЃў рЃЊрЃљ рЃЌрЃћрЃАрЃџрЃў', 'рЃЎрЃљрЃЎрЃљрЃџрЃў рЃЊрЃљ рЃЌрЃћрЃАрЃџрЃў', 'рЃЎрЃљрЃЎрЃљрЃџрЃў рЃЊрЃљ рЃЌрЃћрЃАрЃџрЃў', 'рЃЎрЃљрЃЎрЃљрЃџрЃў рЃЊрЃљ рЃЌрЃћрЃАрЃџрЃў', 'рЃЎрЃљрЃЎрЃљрЃџрЃў рЃЊрЃљ рЃЌрЃћрЃАрЃџрЃў', 'рЃЎрЃљрЃЎрЃљрЃџрЃў рЃЊрЃљ рЃЌрЃћрЃАрЃџрЃў',
        'рЃАрЃБрЃърЃћрЃарЃцрЃБрЃЊрЃў', 'рЃАрЃБрЃърЃћрЃарЃцрЃБрЃЊрЃў', 'рЃЏрЃфрЃћрЃюрЃљрЃарЃћрЃБрЃџрЃў рЃарЃФрЃћ', 'рЃАрЃЮрЃўрЃЮрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў', 'рЃАрЃљрЃЎрЃЮрЃюрЃЊрЃўрЃбрЃарЃЮ рЃюрЃљрЃгрЃљрЃарЃЏрЃў', 'рЃАрЃБрЃърЃћрЃарЃцрЃБрЃЊрЃў', 'рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃБрЃџрЃў', 'рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў', 'рЃЏрЃфрЃћрЃюрЃљрЃарЃћрЃБрЃџрЃў рЃарЃФрЃћ', 'рЃЌрЃћрЃЋрЃќрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў', 'рЃАрЃЮрЃЎрЃЮ',
        # рЃљрЃ«рЃљрЃџрЃў рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃћрЃЉрЃў
        'рЃърЃБрЃарЃў рЃЊрЃљ рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃБрЃџрЃў', 'рЃърЃБрЃарЃў рЃЊрЃљ рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃБрЃџрЃў', 'рЃърЃБрЃарЃў рЃЊрЃљ рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃБрЃџрЃў', 'рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў',
        'рЃфрЃ«рЃўрЃЏрЃћрЃЉрЃў рЃЊрЃљ рЃќрЃћрЃЌрЃћрЃЉрЃў', 'рЃфрЃ«рЃўрЃЏрЃћрЃЉрЃў рЃЊрЃљ рЃќрЃћрЃЌрЃћрЃЉрЃў', 'рЃфрЃ«рЃўрЃЏрЃћрЃЉрЃў рЃЊрЃљ рЃќрЃћрЃЌрЃћрЃЉрЃў',
        'рЃ«рЃЮрЃарЃфрЃў', 'рЃдрЃЋрЃўрЃФрЃџрЃў', 'рЃдрЃЋрЃўрЃФрЃџрЃў',
        'рЃЎрЃЋрЃћрЃарЃфрЃ«рЃў', 'рЃЎрЃЋрЃћрЃарЃфрЃ«рЃў',
        'рЃгрЃўрЃЌрЃћрЃџрЃў рЃЮрЃАрЃърЃў', 'рЃгрЃўрЃгрЃўрЃџрЃљ (Chickpeas)',
        'рЃЉрЃарЃЮрЃЎрЃЮрЃџрЃў (рЃЏрЃЮрЃ«рЃљрЃарЃерЃБрЃџрЃў)', 'рЃАрЃЮрЃЎрЃЮ (рЃЌрЃћрЃЌрЃарЃў)', 'рЃърЃЮрЃЏрЃўрЃЊрЃЮрЃарЃў', 'рЃЎрЃўрЃбрЃарЃў', 'рЃЉрЃљрЃЊрЃарЃўрЃ»рЃљрЃюрЃў',
        'рЃЏрЃљрЃДрЃЋрЃљрЃџрЃў', 'рЃЪрЃЮрЃџрЃЮ', 'рЃљрЃбрЃљрЃЏрЃў', 'рЃЦрЃџрЃўрЃљрЃЋрЃў', 'рЃљрЃџрЃБрЃЉрЃљрЃџрЃў',
        'рЃцрЃћрЃбрЃЋрЃў', 'рЃЦрЃћрЃарЃў', 'рЃљрЃЏрЃљрЃарЃљрЃюрЃбрЃў',
        'рЃЏрЃЊрЃЮрЃњрЃЋрЃўрЃА рЃЏрЃгрЃЋрЃљрЃюрЃўрЃџрЃў', 'рЃбрЃБрЃарЃюрЃўрЃърЃўрЃА рЃЏрЃгрЃЋрЃљрЃюрЃўрЃџрЃў', 'рЃарЃБрЃЎрЃЮрЃџрЃљ',
        'рЃарЃФрЃћ (рЃюрЃљрЃ«рЃћрЃЋрЃарЃљрЃЊ рЃБрЃфрЃ«рЃўрЃЏрЃЮ)', 'рЃарЃўрЃЎрЃЮрЃбрЃљ рЃДрЃЋрЃћрЃџрЃў', 'рЃърЃљрЃарЃЏрЃћрЃќрЃљрЃюрЃў', 'рЃЌрЃ«рЃўрЃА рЃДрЃЋрЃћрЃџрЃў'
    ],
    'рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў_рЃЎрЃЎрЃљрЃџ': [ # Calories per 100g
        131, 135, 165, 135, 104, 294, 137, # Meat
        208, 116, 208, 85, 86, 200, 82, 205, # Fish/Seafood
        23, 34, 41, 86, 25, 31, 31, 49, 43, 22, 81, 43, 36, 149, 80, 31, # Vegetables
        160, 89, 47, 61, 32, 57, 52, 29, 42, 241, # Fruits
        717, 61, 59, 404, 155, 103, 64, # Dairy/Eggs
        347, 116, 343, 111, 378, 389, 116, # Legumes/Grains
        579, 654, 486, 584, 574, 553, 567, 659, 629, # Nuts/Seeds
        290, 420, 54, 76, 598, 200, 275, 590, 354, 900, 22, # Superfoods/Misc
        # New products calories (approximate values)
        265, 389, 158, 86, # Bread/Grains
        884, 862, 884, # Fats/Oils
        210, 140, 110, # More Meat/Liver
        160, 50, # Eggs parts
        116, 164, # More legumes
        35, 28, 18, 16, 25, # More vegetables
        50, 52, 49, 46, 50, # More fruits
        378, 322, 371, # More grains
        30, 32, 25, # More greens
        47, 300, 390, 320 # More dairy
    ],
    'рЃарЃЎрЃўрЃюрЃљ_рЃЏрЃњ': [
        3.3, 30.5, 0.9, 13.0, 2.5, 2.1, 3.5,
        0.8, 1.3, 2.9, 1.8, 6.7, 90.0, 1.0, 1.6,
        2.7, 0.7, 0.3, 0.7, 0.5, 0.5, 0.5, 1.5, 0.5, 0.5, 1.5, 1.0, 2.0, 1.7, 0.6, 1.0,
        0.6, 0.3, 0.1, 0.3, 0.3, 0.2, 0.2, 0.2, 0.2, 1.5,
        0.2, 0.03, 0.1, 0.4, 1.2, 0.4, 0.1,
        6.2, 7.5, 2.2, 0.8, 4.6, 4.0, 6.0,
        2.9, 2.7, 7.7, 5.2, 3.3, 4.0, 3.9, 2.5, 5.0,
        28.5, 58.0, 0.5, 2.0, 3.0, 1.5, 10.0, 1.5, 0.5, 0.1, 0.2,
        # New products
        2.5, 3.0, 1.5, 0.5,
        0.1, 0.1, 0.1,
        2.8, 7.0, 3.0,
        1.5, 0.0,
        2.0, 2.5,
        0.7, 0.5, 0.3, 0.2, 0.2,
        0.2, 0.2, 0.2, 0.1, 0.1,
        2.0, 1.5, 2.5,
        1.0, 1.2, 0.8,
        0.05, 0.1, 0.2, 0.1
    ],
    'B12_рЃЏрЃЎрЃњ': [
        2.6, 83.1, 0.3, 16.6, 0.4, 2.1, 3.0,
        4.9, 4.3, 8.9, 1.1, 24.0, 1.5, 5.4, 19.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.2, 0.4, 0.5, 0.8, 0.6, 0.4, 1.2,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
        175.0, 65.0, 2.4, 0.0, 0.0, 5.0, 0.0, 0.0, 0.0, 100.0, 0.0,
        # New products
        0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
        1.5, 50.0, 15.0,
        0.8, 0.0,
        0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
        0.0, 0.0, 0.0,
        0.4, 0.0, 0.0, 0.0
    ],
    'рЃцрЃЮрЃџрЃљрЃбрЃў_рЃЏрЃЎрЃњ': [
        4, 290, 3, 588, 4, 7, 5,
        26, 5, 10, 3, 76, 180, 12, 2,
        194, 63, 3, 40, 107, 24, 30, 140, 60, 17, 30, 150, 170, 15, 10, 33,
        81, 20, 30, 25, 20, 6, 3, 30, 20, 200,
        3, 5, 7, 27, 47, 24, 5,
        394, 181, 30, 8, 184, 56, 200,
        28, 45, 49, 227, 15, 60, 70, 10, 80,
        94, 23, 50, 29, 30, 50, 160, 60, 15, 0, 17,
        # New products
        40, 56, 10, 50,
        0, 0, 0,
        5, 300, 60,
        40, 0,
        180, 168,
        60, 20, 20, 15, 10,
        10, 15, 10, 8, 10,
        30, 20, 40,
        180, 200, 120,
        7, 10, 5, 10
    ],
    'C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ': [
        0, 1, 0, 17, 0, 0, 0,
        0, 0, 0, 2, 8, 3, 0, 0,
        28, 89, 6, 20, 36, 128, 60, 120, 110, 2, 10, 85, 133, 5, 5, 5,
        10, 9, 53, 93, 59, 10, 4, 53, 40, 1,
        0, 0, 0, 0, 0, 0, 1,
        2, 5, 0, 0, 0, 0, 0,
        1, 1, 0, 1, 0, 0, 0, 0, 0,
        10, 9, 0, 0, 0, 0, 0, 0, 0, 0, 2,
        # New products
        0, 0, 0, 10,
        0, 0, 0,
        0, 1, 15,
        0, 0,
        2, 2,
        90, 5, 13, 7, 2,
        5, 5, 5, 4, 10,
        0, 0, 0,
        30, 20, 10,
        0, 0, 0, 0
    ],
    'D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU': [
        3, 15, 0, 44, 6, 53, 7,
        360, 154, 164, 5, 76, 0, 388, 388,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 375, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        142, 115, 5, 24, 82, 0, 100,
        0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 100, 0, 0, 0, 0, 0, 0, 1360, 1000,
        # New products
        0, 0, 0, 0,
        0, 0, 0,
        10, 20, 5,
        40, 0,
        0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0, 0, 0,
        0, 0, 0,
        100, 0, 0, 0,
        0, 0, 0 # Added one more zero to match length 109
    ],
    'рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў_рЃЏрЃњ': [
        12, 5, 8, 8, 10, 7, 12,
        12, 4, 382, 70, 26, 1170, 20, 12,
        99, 47, 6, 30, 40, 10, 40, 150, 60, 3, 30, 200, 170, 20, 10, 50,
        12, 5, 40, 34, 13, 8, 7, 30, 20, 5,
        24, 113, 110, 721, 50, 83, 120,
        113, 35, 20, 23, 47, 52, 150,
        37, 28, 177, 78, 50, 60, 100, 160, 10,
        120, 74, 300, 350, 100, 20, 200, 20, 10, 10, 5,
        # New products
        30, 40, 10, 10,
        0, 0, 0,
        15, 8, 10,
        50, 5,
        120, 100,
        50, 10, 10, 8, 10,
        20, 25, 20, 15, 20,
        30, 20, 40,
        200, 180, 150,
        110, 800, 1000, 300
    ],
    'рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў_рЃЏрЃњ': [
        20, 18, 29, 19, 25, 17, 25,
        29, 64, 39, 39, 34, 560, 27, 97,
        79, 21, 12, 25, 12, 10, 15, 30, 20, 9, 40, 50, 30, 25, 18, 20,
        29, 27, 10, 15, 10, 12, 5, 10, 12, 150,
        2, 10, 11, 28, 10, 8, 12,
        140, 36, 112, 143, 197, 138, 150,
        158, 183, 335, 325, 262, 292, 121, 197, 251,
        195, 315, 25, 50, 100, 15, 50, 150, 15, 5, 10,
        # New products
        40, 50, 20, 25,
        0, 0, 0,
        30, 20, 15,
        10, 0,
        30, 25,
        25, 15, 10, 8, 12,
        15, 18, 12, 10, 15,
        40, 35, 50,
        80, 90, 70,
        10, 10, 15, 18
    ],
    'рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў_рЃЏрЃњ': [
        350, 320, 300, 290, 300, 320, 380,
        363, 290, 397, 259, 290, 990, 290, 360,
        558, 316, 300, 337, 250, 211, 250, 350, 280, 260, 450, 500, 450, 400, 415, 200,
        487, 358, 180, 200, 150, 150, 100, 100, 150, 600,
        24, 150, 170, 90, 138, 150, 150,
        644, 900, 380, 220, 170, 429, 600,
        705, 440, 407, 894, 500, 600, 700, 600, 700,
        800, 700, 150, 120, 100, 50, 250, 350, 150, 0, 200,
        # New products
        150, 200, 100, 270,
        0, 0, 0,
        320, 280, 250,
        130, 0,
        600, 500,
        300, 250, 200, 180, 150,
        160, 180, 190, 170, 180,
        300, 280, 320,
        350, 380, 300,
        150, 120, 100, 160
    ],
    'рЃЌрЃБрЃЌрЃўрЃљ_рЃЏрЃњ': [
        4.0, 7.0, 0.4, 2.7, 2.0, 2.5, 4.5,
        0.6, 0.8, 1.3, 0.6, 1.3, 4.0, 0.5, 1.2,
        0.1, 0.2, 0.1, 0.2, 0.2, 0.1, 0.1, 0.2, 0.2, 0.5, 0.5, 0.5, 0.5, 0.3, 0.3, 0.3,
        0.4, 0.2, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.5,
        0.1, 0.4, 0.5, 3.0, 1.1, 0.5, 0.4,
        3.0, 1.3, 1.3, 0.8, 2.0, 2.0, 2.0,
        0.9, 0.9, 3.5, 5.0, 2.0, 1.5, 1.5, 2.0, 1.0,
        0.7, 0.5, 0.8, 0.8, 1.0, 0.5, 2.0, 0.5, 0.1, 0.1, 0.5,
        # New products
        0.8, 1.0, 0.5, 0.4,
        0.0, 0.0, 0.0,
        1.5, 3.0, 1.0,
        1.0, 0.0,
        1.0, 1.2,
        0.2, 0.1, 0.1, 0.1, 0.1,
        0.1, 0.1, 0.1, 0.1, 0.1,
        1.5, 1.0, 1.8,
        0.5, 0.6, 0.4,
        0.5, 1.0, 1.5, 0.8
    ],
    'A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE': [
        1, 1000, 10, 800, 5, 5, 10,
        20, 20, 10, 10, 10, 5, 10, 30,
        469, 31, 835, 709, 5, 47, 50, 500, 250, 0, 10, 50, 100, 10, 0, 10,
        7, 3, 22, 23, 30, 10, 5, 10, 15, 0,
        100, 50, 10, 100, 50, 20, 60,
        1, 1, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0,
        300, 200, 50, 0, 0, 0, 0, 0, 0, 5, 0,
        # New products
        0, 0, 0, 30,
        0, 0, 0,
        10, 800, 200,
        200, 0,
        1, 5,
        40, 10, 5, 3, 20,
        10, 12, 8, 5, 7,
        0, 0, 0,
        600, 700, 300,
        80, 50, 100, 60
    ],
    'E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE': [
        0.5, 0.5, 0.2, 0.3, 0.1, 0.1, 0.2,
        0.8, 0.2, 0.2, 0.1, 0.1, 0.1, 0.1, 0.5,
        0.3, 0.8, 0.7, 0.3, 0.1, 1.6, 0.2, 0.5, 0.3, 0.1, 0.2, 0.5, 0.2, 0.1, 0.1, 0.1,
        2.1, 0.4, 0.2, 0.1, 0.4, 0.2, 0.1, 0.1, 0.2, 0.0,
        0.8, 0.1, 0.1, 0.1, 0.5, 0.1, 0.1,
        0.0, 0.1, 0.1, 0.0, 0.0, 0.1, 0.0,
        7.7, 2.7, 0.5, 35.0, 0.1, 2.0, 2.9, 0.5, 1.0,
        0.1, 0.1, 0.1, 0.0, 0.5, 0.0, 0.5, 0.0, 0.1, 0.1, 0.1,
        # New products
        0.1, 0.5, 0.2, 0.1,
        14.0, 8.0, 20.0,
        0.5, 0.8, 0.3,
        0.5, 0.0,
        0.1, 0.2,
        0.8, 0.5, 0.3, 0.2, 0.1,
        0.2, 0.2, 0.2, 0.1, 0.2,
        0.1, 0.1, 0.1,
        0.5, 0.6, 0.4,
        0.1, 0.1, 0.1, 0.1
    ],
    'K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ': [
        1, 3, 0, 5, 0, 0, 0,
        5, 0, 0, 0, 0, 0, 0, 0,
        483, 102, 19, 21, 109, 14, 80, 681, 177, 0, 3, 160, 200, 0, 0, 0,
        21, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        7, 0, 0, 0, 0, 0, 0,
        4, 4, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        # New products
        0, 0, 0, 10,
        0, 0, 0,
        1, 2, 8,
        0, 0,
        5, 4,
        100, 15, 8, 5, 10,
        0, 0, 0, 0, 0,
        0, 0, 0,
        250, 300, 180,
        0, 0, 0, 0
    ],
    'рЃАрЃћрЃџрЃћрЃюрЃў_рЃЏрЃЎрЃњ': [
        35, 50, 20, 50, 20, 25, 40,
        40, 90, 55, 30, 20, 150, 100, 80,
        1, 1, 0.2, 0.6, 0.3, 0.1, 0.3, 0.5, 0.4, 0.5, 0.5, 1, 1, 0.6, 0.2, 1,
        0.4, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 1,
        1, 2, 2, 10, 15, 2, 5,
        0.6, 0.6, 0.3, 10, 5, 10, 1,
        0.2, 0.1, 0.4, 0.4, 10, 1, 10, 544, 1,
        4, 2, 10, 10, 5, 20, 50, 5, 1, 80, 5,
        # New products
        5, 6, 3, 0.5,
        0, 0, 0,
        25, 30, 10,
        15, 0,
        0.5, 1.0,
        0.8, 0.5, 0.3, 0.2, 0.1,
        0.1, 0.1, 0.1, 0.1, 0.1,
        1.5, 1.0, 2.0,
        20, 25, 15,
        2, 1, 3, 1
    ]
}

# Verify all lists in products_data have the same length before creating DataFrame
first_key = list(products_data.keys())[0]
expected_length = len(products_data[first_key])
for key, value in products_data.items():
    if len(value) != expected_length:
        st.error(f"Error: List '{key}' has length {len(value)}, but expected {expected_length}. Please check your data for consistency.")
        st.stop() # Stop the app execution if there's an inconsistency

# DataFrame-рЃўрЃА рЃерЃћрЃЦрЃЏрЃюрЃљ
df = pd.DataFrame(products_data)

# Callback рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА
def clear_nutrients_multiselect_tab4():
    st.session_state.nutrients_multiselect_tab4 = []

# рЃЊрЃљрЃЏрЃ«рЃЏрЃљрЃарЃћ рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃдрЃўрЃџрЃљрЃЎрЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА (рЃФрЃћрЃЉрЃюрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃўрЃА рЃњрЃљрЃюрЃљрЃ«рЃџрЃћрЃЉрЃљ)
def set_search_and_min_amount(search_term_val, min_amount_val=0.0):
    st.session_state.search_term = search_term_val
    st.session_state.min_amount = min_amount_val

# --- рЃЊрЃљрЃЏрЃ«рЃЏрЃљрЃарЃћ рЃцрЃБрЃюрЃЦрЃфрЃўрЃћрЃЉрЃў ---
def find_nutrient_column(search_term):
    """
    рЃърЃЮрЃБрЃџрЃЮрЃЉрЃА рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃА рЃАрЃЋрЃћрЃбрЃА рЃФрЃўрЃћрЃЉрЃўрЃА рЃбрЃћрЃарЃЏрЃўрЃюрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ.
    рЃћрЃА рЃцрЃБрЃюрЃЦрЃфрЃўрЃљ рЃњрЃљрЃБрЃЏрЃ»рЃЮрЃЉрЃћрЃАрЃћрЃЉрЃБрЃџрЃўрЃљ, рЃарЃљрЃЌрЃљ рЃБрЃЎрЃћрЃЌ рЃЏрЃЮрЃФрЃћрЃЉрЃюрЃЮрЃА рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃћрЃЉрЃў,
    рЃЏрЃљрЃерЃўрЃюрЃљрЃф рЃЎрЃў, рЃЌрЃБ рЃбрЃћрЃарЃЏрЃўрЃюрЃў рЃќрЃБрЃАрЃбрЃљрЃЊ рЃљрЃа рЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљ рЃАрЃЋрЃћрЃбрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃА.
    """
    search_lower = search_term.lower()
    
    nutrient_mapping = {
        'рЃарЃЎрЃўрЃюрЃљ': 'рЃарЃЎрЃўрЃюрЃљ_рЃЏрЃњ', 'iron': 'рЃарЃЎрЃўрЃюрЃљ_рЃЏрЃњ', 'fe': 'рЃарЃЎрЃўрЃюрЃљ_рЃЏрЃњ',
        'b12': 'B12_рЃЏрЃЎрЃњ', 'рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў b12': 'B12_рЃЏрЃЎрЃњ', 'vitamin b12': 'B12_рЃЏрЃЎрЃњ', 'рЃЎрЃЮрЃЉрЃљрЃџрЃљрЃЏрЃўрЃюрЃў': 'B12_рЃЏрЃЎрЃњ',
        'рЃцрЃЮрЃџрЃљрЃбрЃў': 'рЃцрЃЮрЃџрЃљрЃбрЃў_рЃЏрЃЎрЃњ', 'folate': 'рЃцрЃЮрЃџрЃљрЃбрЃў_рЃЏрЃЎрЃњ', 'рЃцрЃЮрЃџрЃўрЃБрЃЏрЃўрЃА рЃЏрЃЪрЃљрЃЋрЃљ': 'рЃцрЃЮрЃџрЃљрЃбрЃў_рЃЏрЃЎрЃњ',
        'c': 'C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ', 'рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў c': 'C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ', 'vitamin c': 'C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ', 'c рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў': 'C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ', 'рЃљрЃАрЃЎрЃЮрЃарЃЉрЃўрЃюрЃўрЃА рЃЏрЃЪрЃљрЃЋрЃљ': 'C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ',
        'd': 'D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU', 'рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў d': 'D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU', 'vitamin d': 'D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU', 'd рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў': 'D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU', 'рЃЎрЃљрЃџрЃфрЃўрЃцрЃћрЃарЃЮрЃџрЃў': 'D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU',
        'рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў': 'рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў_рЃЏрЃњ', 'calcium': 'рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў_рЃЏрЃњ', 'ca': 'рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў_рЃЏрЃњ',
        'рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў': 'рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў_рЃЏрЃњ', 'magnesium': 'рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў_рЃЏрЃњ', 'mg': 'рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў_рЃЏрЃњ',
        'рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў': 'рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў_рЃЏрЃњ', 'potassium': 'рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў_рЃЏрЃњ', 'k (рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў)': 'рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў_рЃЏрЃњ',
        'рЃЌрЃБрЃЌрЃўрЃљ': 'рЃЌрЃБрЃЌрЃўрЃљ_рЃЏрЃњ', 'zinc': 'рЃЌрЃБрЃЌрЃўрЃљ_рЃЏрЃњ', 'zn': 'рЃЌрЃБрЃЌрЃўрЃљ_рЃЏрЃњ',
        'a': 'A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE', 'рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў a': 'A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE', 'a рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў': 'A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE', 'vitamin a': 'A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE', 'рЃарЃћрЃбрЃўрЃюрЃЮрЃџрЃў': 'A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE',
        'e': 'E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE', 'рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў e': 'E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE', 'e рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў': 'E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE', 'vitamin e': 'E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE', 'рЃбрЃЮрЃЎрЃЮрЃцрЃћрЃарЃЮрЃџрЃў': 'E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE',
        'k': 'K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ', 'рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў k': 'K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ', 'k рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў': 'K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ', 'vitamin k': 'K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ', 'рЃцрЃўрЃџрЃЮрЃЦрЃЋрЃўрЃюрЃЮрЃюрЃў': 'K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ',
        'рЃАрЃћрЃџрЃћрЃюрЃў': 'рЃАрЃћрЃџрЃћрЃюрЃў_рЃЏрЃЎрЃњ', 'selenium': 'рЃАрЃћрЃџрЃћрЃюрЃў_рЃЏрЃЎрЃњ', 'se': 'рЃАрЃћрЃџрЃћрЃюрЃў_рЃЏрЃЎрЃњ',
        'рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў': 'рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў_рЃЎрЃЎрЃљрЃџ', 'calories': 'рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў_рЃЎрЃЎрЃљрЃџ', 'рЃћрЃюрЃћрЃарЃњрЃўрЃљ': 'рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў_рЃЎрЃЎрЃљрЃџ'
    }
    
    if search_lower in nutrient_mapping:
        return nutrient_mapping[search_lower]
        
    for col in df.columns:
        if col not in ['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў', 'рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ']:
            if search_lower in col.lower():
                return col
            if 'рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў' in search_lower and search_lower.replace('рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў ', '') in col.lower():
                return col
            if 'vitamin' in search_lower and search_lower.replace('vitamin ', '') in col.lower():
                return col

    return None

def get_unit(column_name):
    """рЃЋрЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃЌ рЃерЃћрЃАрЃљрЃЉрЃљрЃЏрЃўрЃА рЃќрЃЮрЃЏрЃўрЃА рЃћрЃарЃЌрЃћрЃБрЃџрЃА"""
    if 'рЃЏрЃњ' in column_name:
        return 'рЃЏрЃњ'
    elif 'рЃЏрЃЎрЃњ' in column_name:
        return 'рЃЏрЃЎрЃњ'
    elif 'IU' in column_name:
        return 'IU'
    elif 'RAE' in column_name:
        return 'рЃЏрЃЎрЃњ RAE'
    elif 'ATE' in column_name:
        return 'рЃЏрЃњ ATE'
    elif 'рЃЎрЃЎрЃљрЃџ' in column_name:
        return 'рЃЎрЃЎрЃљрЃџ'
    return ''

def get_daily_dose(nutrient_name):
    """рЃЋрЃљрЃЉрЃарЃБрЃюрЃћрЃЉрЃЌ рЃЊрЃдрЃўрЃБрЃа рЃЊрЃЮрЃќрЃљрЃА рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃўрЃАрЃЌрЃЋрЃўрЃА"""
    daily_doses = {
        "рЃарЃЎрЃўрЃюрЃљ": "18 рЃЏрЃњ (рЃЦрЃљрЃџрЃћрЃЉрЃў), 8 рЃЏрЃњ (рЃЏрЃљрЃЏрЃљрЃЎрЃљрЃфрЃћрЃЉрЃў)",
        "B12": "2.4 рЃЏрЃЎрЃњ",
        "рЃцрЃЮрЃџрЃљрЃбрЃў": "400 рЃЏрЃЎрЃњ",
        "C рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў": "90 рЃЏрЃњ (рЃЏрЃљрЃЏрЃљрЃЎрЃљрЃфрЃћрЃЉрЃў), 75 рЃЏрЃњ (рЃЦрЃљрЃџрЃћрЃЉрЃў)",
        "D рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў": "600-800 IU",
        "рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў": "1000-1200 рЃЏрЃњ",
        "рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў": "400-420 рЃЏрЃњ (рЃЏрЃљрЃЏрЃљрЃЎрЃљрЃфрЃћрЃЉрЃў), 310-320 рЃЏрЃњ (рЃЦрЃљрЃџрЃћрЃЉрЃў)",
        "рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў": "3500-4700 рЃЏрЃњ",
        "рЃЌрЃБрЃЌрЃўрЃљ": "11 рЃЏрЃњ (рЃЏрЃљрЃЏрЃљрЃЎрЃљрЃфрЃћрЃЉрЃў), 8 рЃЏрЃњ (рЃЦрЃљрЃџрЃћрЃЉрЃў)",
        "A рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў": "700-900 рЃЏрЃЎрЃњ RAE",
        "E рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў": "15 рЃЏрЃњ",
        "K рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў": "90-120 рЃЏрЃЎрЃњ",
        "рЃАрЃћрЃџрЃћрЃюрЃў": "55 рЃЏрЃЎрЃњ",
        "рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў": "2000-2500 рЃЎрЃЎрЃљрЃџ (рЃЦрЃљрЃџрЃћрЃЉрЃў), 2500-3000 рЃЎрЃЎрЃљрЃџ (рЃЏрЃљрЃЏрЃљрЃЎрЃљрЃфрЃћрЃЉрЃў)"
    }
    
    for key, dose in daily_doses.items():
        if key.lower() in nutrient_name.lower():
            return dose
    return None

def calculate_daily_nutrition(selected_products, df):
    """рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃўрЃА рЃАрЃБрЃџ рЃЊрЃдрЃўрЃБрЃа рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃА рЃљрЃарЃЕрЃћрЃБрЃџрЃў рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃўрЃЊрЃљрЃю"""
    if not selected_products:
        return None
    
    total_nutrition = {
        'рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў_рЃЎрЃЎрЃљрЃџ': 0, # Add calories here
        'рЃарЃЎрЃўрЃюрЃљ_рЃЏрЃњ': 0,
        'B12_рЃЏрЃЎрЃњ': 0,
        'рЃцрЃЮрЃџрЃљрЃбрЃў_рЃЏрЃЎрЃњ': 0,
        'C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ': 0,
        'D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU': 0,
        'рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў_рЃЏрЃњ': 0,
        'рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў_рЃЏрЃњ': 0,
        'рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў_рЃЏрЃњ': 0,
        'рЃЌрЃБрЃЌрЃўрЃљ_рЃЏрЃњ': 0,
        'A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE': 0,
        'E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE': 0,
        'K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ': 0,
        'рЃАрЃћрЃџрЃћрЃюрЃў_рЃЏрЃЎрЃњ': 0
    }
    
    for item in selected_products:
        product_data = df[df['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў'] == item['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў']]
        
        if not product_data.empty:
            multiplier = item['рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ'] / 100.0
            
            for nutrient in total_nutrition.keys():
                # Ensure the nutrient column exists before accessing it
                if nutrient in product_data.columns:
                    total_nutrition[nutrient] += product_data.iloc[0][nutrient] * multiplier
    
    return total_nutrition

def get_recommended_doses(gender):
    """рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃў рЃЊрЃдрЃўрЃБрЃарЃў рЃЊрЃЮрЃќрЃћрЃЉрЃў рЃАрЃЦрЃћрЃАрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ, рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃўрЃА рЃЕрЃљрЃЌрЃЋрЃџрЃўрЃЌ"""
    if gender == "рЃЏрЃљрЃЏрЃарЃЮрЃЉрЃўрЃЌрЃў":
        return {
            'рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў_рЃЎрЃЎрЃљрЃџ': 2750, # Average for men
            'рЃарЃЎрЃўрЃюрЃљ_рЃЏрЃњ': 8,
            'B12_рЃЏрЃЎрЃњ': 2.4,
            'рЃцрЃЮрЃџрЃљрЃбрЃў_рЃЏрЃЎрЃњ': 400,
            'C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ': 90,
            'D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU': 700,
            'рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў_рЃЏрЃњ': 1100,
            'рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў_рЃЏрЃњ': 410,
            'рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў_рЃЏрЃњ': 4000,
            'рЃЌрЃБрЃЌрЃўрЃљ_рЃЏрЃњ': 11,
            'A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE': 900,
            'E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE': 15,
            'K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ': 120,
            'рЃАрЃћрЃџрЃћрЃюрЃў_рЃЏрЃЎрЃњ': 55
        }
    else:  # рЃЏрЃЊрЃћрЃЊрЃарЃЮрЃЉрЃўрЃЌрЃў
        return {
            'рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў_рЃЎрЃЎрЃљрЃџ': 2250, # Average for women
            'рЃарЃЎрЃўрЃюрЃљ_рЃЏрЃњ': 18,
            'B12_рЃЏрЃЎрЃњ': 2.4,
            'рЃцрЃЮрЃџрЃљрЃбрЃў_рЃЏрЃЎрЃњ': 400,
            'C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ': 75,
            'D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU': 700,
            'рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў_рЃЏрЃњ': 1100,
            'рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў_рЃЏрЃњ': 315,
            'рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў_рЃЏрЃњ': 4000,
            'рЃЌрЃБрЃЌрЃўрЃљ_рЃЏрЃњ': 8,
            'A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE': 700,
            'E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE': 15,
            'K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ': 90,
            'рЃАрЃћрЃџрЃћрЃюрЃў_рЃЏрЃЎрЃњ': 55
        }

def display_nutrition_analysis(total_nutrition, recommended_doses):
    """рЃЋрЃўрЃќрЃБрЃљрЃџрЃўрЃќрЃљрЃфрЃўрЃљ рЃЊрЃдрЃўрЃБрЃарЃў рЃюрЃЮрЃарЃЏрЃўрЃА рЃљрЃюрЃљрЃџрЃўрЃќрЃўрЃАрЃЌрЃЋрЃўрЃА"""
    
    nutrient_names = {
        'рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў_рЃЎрЃЎрЃљрЃџ': '­ЪћЦ рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў', # Added calories
        'рЃарЃЎрЃўрЃюрЃљ_рЃЏрЃњ': '­ЪћХ рЃарЃЎрЃўрЃюрЃљ',
        'B12_рЃЏрЃЎрЃњ': '­Ъћи B12',
        'рЃцрЃЮрЃџрЃљрЃбрЃў_рЃЏрЃЎрЃњ': '­ЪЪб рЃцрЃЮрЃџрЃљрЃбрЃў',
        'C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ': '­ЪЪА C рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў',
        'D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU': '­ЪЪа D рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў',
        'рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў_рЃЏрЃњ': 'Рџф рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў',
        'рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў_рЃЏрЃњ': '­ЪЪБ рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў',
        'рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў_рЃЏрЃњ': '­Ъћх рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў',
        'рЃЌрЃБрЃЌрЃўрЃљ_рЃЏрЃњ': 'РџФ рЃЌрЃБрЃЌрЃўрЃљ',
        'A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE': 'Рџф A рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў',
        'E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE': '­ЪЪц E рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў',
        'K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ': 'РџФ K рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў',
        'рЃАрЃћрЃџрЃћрЃюрЃў_рЃЏрЃЎрЃњ': 'Рџф рЃАрЃћрЃџрЃћрЃюрЃў'
    }
    
    # рЃЏрЃЌрЃљрЃЋрЃљрЃарЃў рЃЉрЃљрЃарЃљрЃЌрЃћрЃЉрЃў
    cols_per_row = 4
    num_nutrients = len(nutrient_names)
    num_rows = (num_nutrients + cols_per_row - 1) // cols_per_row
    
    for row_idx in range(num_rows):
        cols = st.columns(cols_per_row)
        for i in range(cols_per_row):
            nutrient_index = row_idx * cols_per_row + i
            if nutrient_index < num_nutrients:
                nutrient_key = list(nutrient_names.keys())[nutrient_index]
                nutrient_display_name = list(nutrient_names.values())[nutrient_index]

                current_amount = total_nutrition.get(nutrient_key, 0) # Use .get() for safety
                recommended = recommended_doses.get(nutrient_key, 1) # Use .get() for safety, avoid div by zero

                percentage = (current_amount / recommended) * 100 if recommended > 0 else 0
                
                with cols[i]:
                    if percentage < 50:
                        color = "­Ъћ┤"
                    elif percentage < 100:
                        color = "­ЪЪА"
                    else:
                        color = "­ЪЪб"
                    
                    unit = get_unit(nutrient_key)
                    
                    st.metric(
                        label=f"{color} {nutrient_display_name}",
                        value=f"{current_amount:.1f} {unit}",
                        delta=f"{percentage:.1f}% ({current_amount - recommended:+.1f} {unit})"
                    )
    
    st.markdown("---")
    
    # рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃў рЃљрЃюрЃљрЃџрЃўрЃќрЃў
    st.subheader("­ЪЊѕ рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃў рЃљрЃюрЃљрЃџрЃўрЃќрЃў:")
    
    # рЃърЃарЃЮрЃњрЃарЃћрЃА рЃЉрЃљрЃарЃћрЃЉрЃў
    for nutrient, name in nutrient_names.items():
        current_amount = total_nutrition.get(nutrient, 0)
        recommended = recommended_doses.get(nutrient, 1)
        
        percentage_for_progress = 0
        if recommended > 0:
            percentage_for_progress = min((current_amount / recommended), 1.0) # Cap at 100% for progress bar
        
        unit = get_unit(nutrient)
        
        col1_detail, col2_detail, col3_detail = st.columns([2, 3, 2])
        
        with col1_detail:
            st.write(f"**{name}**")
        
        with col2_detail:
            st.progress(percentage_for_progress)
        
        with col3_detail:
            st.write(f"{current_amount:.1f}/{recommended} {unit}")
    
    # рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃћрЃЉрЃў
    st.markdown("---")
    st.subheader("­ЪњА рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃћрЃЉрЃў:")
    
    recommendations = []
    
    for nutrient, name in nutrient_names.items():
        current_amount = total_nutrition.get(nutrient, 0)
        recommended = recommended_doses.get(nutrient, 1)
        
        percentage = (current_amount / recommended) * 100 if recommended > 0 else 0
        
        if percentage < 50:
            recommendations.append(f"РЮЌ **{name}**: рЃФрЃљрЃџрЃўрЃљрЃю рЃЊрЃљрЃЉрЃљрЃџрЃўрЃљ ({percentage:.1f}%) - рЃЏрЃћрЃбрЃў рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў рЃЊрЃљрЃљрЃЏрЃљрЃбрЃћрЃЌ")
        elif percentage < 100:
            recommendations.append(f"Рџа№ИЈ **{name}**: рЃАрЃљрЃерЃБрЃљрЃџрЃЮрЃќрЃћ рЃЊрЃљрЃЉрЃљрЃџрЃўрЃљ ({percentage:.1f}%) - рЃЎрЃўрЃЊрЃћрЃЋ рЃарЃљрЃЏрЃЊрЃћрЃюрЃўрЃЏрЃћ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў рЃЊрЃљрЃљрЃЏрЃљрЃбрЃћрЃЌ")
        elif percentage > 200:
            recommendations.append(f"РџА **{name}**: рЃФрЃљрЃџрЃўрЃљрЃю рЃЏрЃљрЃдрЃљрЃџрЃўрЃљ ({percentage:.1f}%) - рЃерЃћрЃљрЃЏрЃфрЃўрЃарЃћрЃЌ рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ")
    
    if not recommendations:
        st.success("­ЪјЅ рЃерЃћрЃАрЃљрЃюрЃўрЃерЃюрЃљрЃЋрЃўрЃљ! рЃДрЃЋрЃћрЃџрЃљ рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃў рЃюрЃЮрЃарЃЏрЃљрЃџрЃБрЃа рЃцрЃљрЃарЃњрЃџрЃћрЃЉрЃерЃўрЃљ!")
    else:
        for rec in recommendations:
            st.write(rec)

def search_by_nutrient(df, search_term, min_amount=0):
    """рЃЋрЃўрЃФрЃћрЃЉрЃЌ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃА рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ"""
    nutrient_col = find_nutrient_column(search_term)    
    
    if not nutrient_col:
        return pd.DataFrame()
    
    if min_amount == 0.0:
        results = df[df[nutrient_col] > 0].copy()
    else:
        results = df[df[nutrient_col] >= min_amount].copy()
    
    results = results.sort_values(nutrient_col, ascending=False)
    
    return results

def generate_random_ration(df, num_items=5):
    """
    рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃА рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃўрЃЌ рЃЊрЃдрЃўрЃБрЃа рЃарЃљрЃфрЃўрЃЮрЃюрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃўрЃА рЃАрЃўрЃўрЃЊрЃљрЃю.
    рЃфрЃЊрЃўрЃџрЃЮрЃЉрЃА рЃЏрЃарЃљрЃЋрЃљрЃџрЃцрЃћрЃарЃЮрЃЋрЃюрЃћрЃЉрЃўрЃА рЃЊрЃљрЃфрЃЋрЃљрЃА рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃћрЃЉрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ.
    """
    all_products = df['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў'].unique().tolist()
    all_categories = df['рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'].unique().tolist()
    
    selected_ration_products_names = []
    
    random.shuffle(all_categories) 
    for category in all_categories:
        if len(selected_ration_products_names) >= num_items:
            break
        category_products = df[df['рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'] == category]['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў'].tolist()
        if category_products:
            chosen_product = random.choice(category_products)
            if chosen_product not in selected_ration_products_names:
                selected_ration_products_names.append(chosen_product)

    while len(selected_ration_products_names) < num_items:
        chosen_product = random.choice(all_products)
        if chosen_product not in selected_ration_products_names:
            selected_ration_products_names.append(chosen_product)
            
    return selected_ration_products_names

def optimize_ration(selected_product_names, df, recommended_doses, nutrient_keys, tolerance_percent=0.1):
    """
    рЃЮрЃърЃбрЃўрЃЏрЃўрЃќрЃўрЃарЃћрЃЉрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃўрЃА рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљрЃА (рЃњрЃарЃљрЃЏрЃћрЃЉрЃерЃў) рЃерЃћрЃарЃЕрЃћрЃБрЃџрЃў рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА
    рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџ рЃЊрЃЮрЃќрЃћрЃЉрЃЌрЃљрЃю рЃЏрЃўрЃљрЃ«рЃџрЃЮрЃћрЃЉрЃўрЃА рЃЏрЃўрЃќрЃюрЃўрЃЌ.
    """
    
    prob = LpProblem("Optimize Daily Ration", LpMinimize)
    
    product_vars = LpVariable.dicts("Product", selected_product_names, 5, 500, LpContinuous)

    over_supply = LpVariable.dicts("Over", nutrient_keys, 0)
    under_supply = LpVariable.dicts("Under", nutrient_keys, 0)

    prob += lpSum([over_supply[n] + under_supply[n] for n in nutrient_keys]), "Total Deviation from Recommended Doses"
    
    for nutrient in nutrient_keys:
        total_nutrient_expr = lpSum([
            (df[df['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў'] == p].iloc[0][nutrient] / 100) * product_vars[p]
            for p in selected_product_names if nutrient in df.columns # Ensure column exists
        ])
        
        rec_dose = recommended_doses[nutrient]

        # Ensure rec_dose is not zero for percentage calculations, especially for calories
        min_bound = rec_dose * (1 - tolerance_percent) if rec_dose > 0 else 0
        max_bound = rec_dose * (1 + tolerance_percent) if rec_dose > 0 else float('inf') # Use infinity if rec_dose is zero for upper bound

        prob += total_nutrient_expr + under_supply[nutrient] >= min_bound, f"Min {nutrient}"
        prob += total_nutrient_expr - over_supply[nutrient] <= max_bound, f"Max {nutrient}"

    # Solve the problem
    prob.solve(PULP_CBC_CMD(msg=0))

    optimized_ration = []
    if LpStatus[prob.status] == "Optimal":
        for product_name in selected_product_names:
            amount = product_vars[product_name].varValue
            if amount is not None and amount > 5:
                optimized_ration.append({'рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў': product_name, 'рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ': round(amount, 1)})
        return optimized_ration
    else:
        st.warning(f"PuLP Solver Status: {LpStatus[prob.status]}. рЃЋрЃћрЃа рЃЏрЃЮрЃ«рЃћрЃарЃ«рЃЊрЃљ рЃЮрЃърЃбрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃљ.")
        return []

# --- Calorie calculation (Harris-Benedict formula) ---
def calculate_bmr(weight, height, age, gender):
    if gender == "рЃЏрЃљрЃЏрЃарЃЮрЃЉрЃўрЃЌрЃў":
        bmr = 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age)
    else: # рЃЏрЃЊрЃћрЃЊрЃарЃЮрЃЉрЃўрЃЌрЃў
        bmr = 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age)
    return bmr

def calculate_tdee(bmr, activity_level):
    activity_factors = {
        "рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃарЃў (рЃЏрЃ»рЃЊрЃЮрЃЏрЃљрЃарЃћ рЃфрЃ«рЃЮрЃЋрЃарЃћрЃЉрЃљ)": 1.2,
        "рЃЏрЃАрЃБрЃЉрЃБрЃЦрЃў (рЃЎрЃЋрЃўрЃарЃљрЃерЃў 1-3-рЃ»рЃћрЃа рЃЋрЃљрЃарЃ»рЃўрЃерЃў)": 1.375,
        "рЃќрЃЮрЃЏрЃўрЃћрЃарЃў (рЃЎрЃЋрЃўрЃарЃљрЃерЃў 3-5-рЃ»рЃћрЃа рЃЋрЃљрЃарЃ»рЃўрЃерЃў)": 1.55,
        "рЃЏрЃљрЃдрЃљрЃџрЃў (рЃЎрЃЋрЃўрЃарЃљрЃерЃў 6-7-рЃ»рЃћрЃа рЃЋрЃљрЃарЃ»рЃўрЃерЃў)": 1.725,
        "рЃФрЃљрЃџрЃўрЃљрЃю рЃЏрЃљрЃдрЃљрЃџрЃў (рЃДрЃЮрЃЋрЃћрЃџрЃЊрЃдрЃўрЃБрЃарЃў, рЃўрЃюрЃбрЃћрЃюрЃАрЃўрЃБрЃарЃў рЃЋрЃљрЃарЃ»рЃўрЃерЃў)": 1.9
    }
    return bmr * activity_factors[activity_level]

# --- Streamlit рЃљрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃљ ---
def main():
    st.set_page_config(
        page_title="­ЪЇЈ рЃДрЃЋрЃћрЃџрЃљрЃцрЃћрЃарЃў рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃћрЃЉрЃќрЃћ рЃЊрЃљ рЃЏрЃўрЃюрЃћрЃарЃљрЃџрЃћрЃЉрЃќрЃћ",
        layout="wide",
        initial_sidebar_state="auto",
        menu_items={
            'About': "рЃћрЃА рЃљрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃљ рЃерЃћрЃЦрЃЏрЃюрЃўрЃџрЃўрЃљ рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃърЃўрЃарЃљрЃЊрЃў рЃЎрЃЋрЃћрЃЉрЃўрЃЌрЃў рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃћрЃЉрЃўрЃА рЃЏрЃЮрЃАрЃљрЃгрЃЮрЃЊрЃћрЃЉрЃџрЃљрЃЊ. рЃњрЃЌрЃ«рЃЮрЃЋрЃЌ, рЃњрЃљрЃўрЃЌрЃЋрЃљрЃџрЃўрЃАрЃгрЃўрЃюрЃЮрЃЌ, рЃарЃЮрЃЏ рЃћрЃА рЃљрЃа рЃљрЃарЃўрЃА рЃърЃарЃЮрЃцрЃћрЃАрЃўрЃЮрЃюрЃљрЃџрЃБрЃарЃў рЃАрЃљрЃЏрЃћрЃЊрЃўрЃфрЃўрЃюрЃЮ рЃарЃЕрЃћрЃЋрЃљ."
        }
    )
    
    # session state-рЃўрЃА рЃўрЃюрЃўрЃфрЃўрЃљрЃџрЃўрЃќрЃљрЃфрЃўрЃљ
    if 'search_term' not in st.session_state:
        st.session_state.search_term = ''
    if 'min_amount' not in st.session_state:
        st.session_state.min_amount = 0.0
    if 'selected_products' not in st.session_state:
        st.session_state.selected_products = []
    if 'nutrients_multiselect_tab4' not in st.session_state:
        st.session_state.nutrients_multiselect_tab4 = []
    if 'generated_ration' not in st.session_state:
        st.session_state.generated_ration = []
    if 'current_page' not in st.session_state:
        st.session_state.current_page = "­ЪЉеРђЇРџЋ№ИЈ рЃърЃўрЃарЃљрЃЊрЃў рЃюрЃБрЃбрЃарЃўрЃфрЃўрЃЮрЃџрЃЮрЃњрЃў" # Default page

    # CSS рЃАрЃбрЃљрЃўрЃџрЃў рЃЎрЃЮрЃЏрЃърЃљрЃЦрЃбрЃБрЃарЃў рЃЋрЃўрЃБрЃАрЃЌрЃЋрЃўрЃА рЃЊрЃљ DARK MODE-рЃўрЃА рЃљрЃЊрЃљрЃърЃбрЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА
    st.markdown("""
    <style>
    /* General body and app styling for LIGHT MODE */
    body {
        font-family: 'Open Sans', sans-serif;
        color: #333; /* Dark text for light mode */
        line-height: 1.6;
    }
    .main {
        background-color: #fefefe; /* Very light, clean background for content */
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        margin-top: 20px;
        margin-bottom: 20px;
    }
    .stApp {
        background: linear-gradient(to right, #e0f5f7, #c1e7ed); /* Subtle gradient background */
    }

    /* Headings styling for LIGHT MODE */
    h1 {
        color: #1a7a4f; /* Deeper green for main title */
        text-align: center;
        font-family: 'Merriweather', serif;
        font-size: 2.4em;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 3px solid #66bb6a;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
    }
    h2, h3, h4 {
        color: #2b6b55; /* Darker, richer green for subheadings */
        font-family: 'Merriweather', serif;
        border-bottom: 1px solid #c8e6c9;
        padding-bottom: 5px;
        margin-top: 25px;
        font-size: 1.4em;
    }
    h4 {
        font-size: 1.2em;
    }

    /* Button styling for LIGHT MODE */
    .stButton>button {
        background-color: #66bb6a; /* Medium green button */
        color: white;
        border-radius: 10px;
        border: none;
        # padding: 12px 25px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: block;
        # margin: 25px auto;
        # width: 85%;
        width: 150px;
        max-width: 350px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .stButton>button:hover {
        background-color: #5cb85c;
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    /* Input field styling for LIGHT MODE */
    .stSelectbox, .stNumberInput, .stRadio {
        background-color: #ffffff;
        border-radius: 10px;
        padding: 8px;
        border: 1px solid #a7d9e7;
        box-shadow: inset 0 1px 4px rgba(0,0,0,0.05);
        margin-bottom: 12px;
    }

    /* Alert messages styling for LIGHT MODE */
    .stAlert {
        border-radius: 10px;
        padding: 15px;
        font-size: 0.98em;
        line-height: 1.5;
        margin-top: 15px;
        margin-bottom: 15px;
    }
    .stAlert.warning {
        background-color: #fff8e1;
        border-color: #ffecb3;
        color: #e69100;
    }
    .stAlert.info {
        background-color: #e0f7fa;
        border-color: #b2ebf2;
        color: #00796b;
    }

    /* Sidebar styling for LIGHT MODE */
    .css-1d391kg { /* Streamlit sidebar background */
        background-color: #e0f8f8;
        border-right: 1px solid #b2e0e0;
        box-shadow: 3px 0 8px rgba(0,0,0,0.05);
    }

    /* Expander styling for LIGHT MODE */
    .st-emotion-cache-1r6dm7m { /* Expander header color */
        color: #2b6b55;
        font-weight: bold;
        font-size: 1.15em;
    }
    .st-emotion-cache-eczf16 { /* Expander content background */
        background-color: #f8fcfc;
        border-radius: 10px;
        padding: 15px;
        margin-top: 10px;
        border: 1px dashed #d5f2f5;
        box-shadow: inset 0 1px 5px rgba(0,0,0,0.02);
    }

    /* Markdown list styling */
    ul {
        padding-left: 25px;
        list-style-type: disc;
    }
    li {
        margin-bottom: 8px;
    }

    /* Sidebar Radio Button Styling - START */
    /* Target the container of the radio buttons in the sidebar */
    .st-emotion-cache-1r6dm7m > div[data-baseweb="radio"] { /* This targets the div that contains the radio labels */
        padding: 0; /* Remove default padding */
    }

    /* Target individual radio labels to make them look like buttons */
    .st-emotion-cache-1r6dm7m > div[data-baseweb="radio"] > label {
        display: block;
        padding: 12px 15px;
        margin: 5px 0; /* Space between "buttons" */
        border-radius: 8px;
        background-color: #f0f0f0; /* Light background for unselected */
        color: #333; /* Dark text for unselected */
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        font-size: 1.1em;
        font-weight: 500;
        border: 1px solid #e0e0e0;
        text-align: left; /* Align text to the left */
    }

    /* Hide the actual radio circle */
    .st-emotion-cache-1r6dm7m > div[data-baseweb="radio"] input[type="radio"] {
        display: none;
    }

    /* Style for the text part of the radio button */
    .st-emotion-cache-1r6dm7m > div[data-baseweb="radio"] label > div:nth-child(2) {
        flex: 1; /* Make the text div take full width */
    }

    /* Hover effect */
    .st-emotion-cache-1r6dm7m > div[data-baseweb="radio"] label:hover {
        background-color: #e6e6e6; /* Slightly darker on hover */
        transform: translateY(-1px);
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* Selected state */
    .st-emotion-cache-1r6dm7m > div[data-baseweb="radio"] label.st-emotion-cache-1r6dm7m:has(input:checked) {
        background-color: #4CAF50; /* Green for selected */
        color: white;
        border-color: #4CAF50;
        font-weight: bold;
        box-shadow: 0 3px 8px rgba(0,128,0,0.2);
    }
    /* Sidebar Radio Button Styling - END */


    /* --- DARK MODE specific styles --- */
    @media (prefers-color-scheme: dark) {
        body {
            color: #e0e0e0; /* Light grey text for dark mode */
        }
        .main {
            background-color: #2c2c2c; /* Darker background for content */
            box-shadow: 0 8px 20px rgba(0,0,0,0.4); /* More pronounced shadow */
        }
        .stApp {
            background: linear-gradient(to right, #1a1a1a, #2a2a2a); /* Dark gradient background */
        }

        /* Headings styling for DARK MODE */
        h1 {
            color: #90ee90; /* Lighter green for main title in dark mode */
            border-bottom-color: #4CAF50; /* More vibrant green line */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
        }
        h2, h3, h4 {
            color: #a0e6a0; /* Lighter green for subheadings */
            border-bottom-color: #3e8e41;
        }

        /* Button styling for DARK MODE */
        .stButton>button {
            # background-color: #4CAF50; /* Green button remains vibrant */
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .stButton>button:hover {
            background-color: #3e8e41;
            box-shadow: 0 6px 12px rgba(0,0,0,0.5);
        }

        /* Input field styling for DARK MODE */
        .stSelectbox, .stNumberInput, .stRadio {
            background-color: #3c3c3c; /* Darker background for inputs */
            border-color: #555; /* Softer border */
            color: #e0e0e0; /* Light text in inputs */
        }
        /* Ensure text in selectbox/numberinput is light */
        .stSelectbox div[data-baseweb="select"] {
            color: #e0e0e0 !important;
        }
        .stNumberInput input {
            color: #e0e0e0 !important;
        }
        .stRadio label {
            color: #e0e0e0 !important;
        }


        /* Alert messages styling for DARK MODE */
        .stAlert {
            background-color: #444; /* Darker background for alerts */
            border-color: #666;
            color: #e0e0e0;
        }
        .stAlert.warning {
            background-color: #5c4700; /* Darker warning background */
            border-color: #8c6e00;
            color: #ffe082; /* Lighter warning text */
        }
        .stAlert.info {
            background-color: #1a4f66; /* Darker info background */
            border-color: #3a7a92;
            color: #81d4fa; /* Lighter info text */
        }


        /* Sidebar styling for DARK MODE */
        .css-1d391kg {
            background-color: #222; /* Darker sidebar background */
            border-right-color: #333;
            box-shadow: 3px 0 8px rgba(0,0,0,0.2);
        }

        /* Expander styling for DARK MODE */
        .st-emotion-cache-1r6dm7m { /* Expander header color */
            color: #90ee90;
        }
        .st-emotion-cache-eczf16 { /* Expander content background */
            background-color: #333; /* Darker content background */
            border-color: #555;
            box-shadow: inset 0 1px 5px rgba(0,0,0,0.2);
        }

        /* Specific styles for nutrition cards in dark mode */
        .nutrition-card {
            background-color: #333333;
            color: #f8f9fa;
            border-left: 3px solid #66b3ff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .nutrition-card h4 {
            color: #f8f9fa !important;
        }
        .nutrition-value {
            color: #99ccff !important;
        }
        .stMarkdown, .stText, .stLabel {
            color: #f8f9fa;
        }
        .stMetric {
            background-color: #26272e;
            border: 1px solid #3d404d;
        }

        /* Sidebar Radio Button Styling - DARK MODE */
        .st-emotion-cache-1r6dm7m > div[data-baseweb="radio"] > label {
            background-color: #3a3a3a;
            color: #e0e0e0;
            border-color: #555;
        }
        .st-emotion-cache-1r6dm7m > div[data-baseweb="radio"] > label:hover {
            background-color: #4a4a4a;
        }
        .st-emotion-cache-1r6dm7m > div[data-baseweb="radio"] > label.st-emotion-cache-1r6dm7m:has(input:checked) {
            background-color: #66bb6a; /* Lighter green for dark mode selected */
            color: white;
            border-color: #66bb6a;
            box-shadow: 0 3px 8px rgba(0,200,0,0.2);
        }
    }
    </style>
    """, unsafe_allow_html=True)


    # Sidebar Navigation
    with st.sidebar:
        st.header("рЃюрЃљрЃЋрЃўрЃњрЃљрЃфрЃўрЃљ")
        if st.button("­ЪЉеРђЇРџЋ№ИЈ **рЃърЃўрЃарЃљрЃЊрЃў рЃюрЃБрЃбрЃарЃўрЃфрЃўрЃЮрЃџрЃЮрЃњрЃў**", key="btn_nutr"):
            st.session_state.current_page = "­ЪЉеРђЇРџЋ№ИЈ рЃърЃўрЃарЃљрЃЊрЃў рЃюрЃБрЃбрЃарЃўрЃфрЃўрЃЮрЃџрЃЮрЃњрЃў"
        if st.button("­ЪћЇ **рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃўрЃА рЃФрЃўрЃћрЃЉрЃљ**", key="btn_search"):
            st.session_state.current_page = "­ЪћЇ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃўрЃА рЃФрЃўрЃћрЃЉрЃљ"
        if st.button("­ЪД« **рЃЊрЃдрЃўрЃБрЃарЃў рЃюрЃЮрЃарЃЏрЃўрЃА рЃЎрЃљрЃџрЃЎрЃБрЃџрЃљрЃбрЃЮрЃарЃў**", key="btn_calc"):
            st.session_state.current_page = "­ЪД« рЃЊрЃдрЃўрЃБрЃарЃў рЃюрЃЮрЃарЃЏрЃўрЃА рЃЎрЃљрЃџрЃЎрЃБрЃџрЃљрЃбрЃЮрЃарЃў"
        if st.button("­ЪЊѕ **рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў**", key="btn_data"):
            st.session_state.current_page = "­ЪЊѕ рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў"
        if st.button("Рюе **рЃЊрЃдрЃўрЃБрЃарЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃерЃћрЃЊрЃњрЃћрЃюрЃљ**", key="btn_ration"):
            st.session_state.current_page = "Рюе рЃЊрЃдрЃўрЃБрЃарЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃерЃћрЃЊрЃњрЃћрЃюрЃљ"
        # page_options = [
        #     "­ЪЉеРђЇРџЋ№ИЈ рЃърЃўрЃарЃљрЃЊрЃў рЃюрЃБрЃбрЃарЃўрЃфрЃўрЃЮрЃџрЃЮрЃњрЃў",
        #     "­ЪћЇ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃўрЃА рЃФрЃўрЃћрЃЉрЃљ",
        #     "­ЪД« рЃЊрЃдрЃўрЃБрЃарЃў рЃюрЃЮрЃарЃЏрЃўрЃА рЃЎрЃљрЃџрЃЎрЃБрЃџрЃљрЃбрЃЮрЃарЃў",
        #     "­ЪЊѕ рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў",
        #     "Рюе рЃЊрЃдрЃўрЃБрЃарЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃерЃћрЃЊрЃњрЃћрЃюрЃљ"
        # ]
        # st.session_state.current_page = st.radio(
        #     "рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ рЃњрЃЋрЃћрЃарЃЊрЃў:",
        #     page_options,
        #     key="sidebar_navigation_radio" # Unique key for sidebar radio
        # )

    # Main Content Area based on selected page
    if st.session_state.current_page == "­ЪЉеРђЇРџЋ№ИЈ рЃърЃўрЃарЃљрЃЊрЃў рЃюрЃБрЃбрЃарЃўрЃфрЃўрЃЮрЃџрЃЮрЃњрЃў":
        st.header("­ЪЉеРђЇРџЋ№ИЈ­ЪЇЈ рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃърЃўрЃарЃљрЃЊрЃў рЃюрЃБрЃбрЃарЃўрЃфрЃўрЃЮрЃџрЃЮрЃњрЃў")
        
        st.write("­ЪЊЮрЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃћрЃЌ рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў рЃЊрЃљ рЃЏрЃўрЃўрЃдрЃћрЃЌ рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃў рЃЎрЃЋрЃћрЃЉрЃўрЃЌрЃў рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃћрЃЉрЃў рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃўрЃюрЃЊрЃўрЃЋрЃўрЃЊрЃБрЃљрЃџрЃБрЃарЃў рЃАрЃљрЃГрЃўрЃарЃЮрЃћрЃЉрЃћрЃЉрЃўрЃА рЃњрЃљрЃЌрЃЋрЃљрЃџрЃўрЃАрЃгрЃўрЃюрЃћрЃЉрЃўрЃЌ.")

        # --- User data input ---
        gender_personal = st.radio("­ЪДЇ **рЃАрЃЦрЃћрЃАрЃў:**", ("рЃЏрЃљрЃЏрЃарЃЮрЃЉрЃўрЃЌрЃў", "рЃЏрЃЊрЃћрЃЊрЃарЃЮрЃЉрЃўрЃЌрЃў"), key="gender_personal_page", horizontal=True)
        weight = st.number_input("Рџќ№ИЈ **рЃгрЃЮрЃюрЃљ (рЃЎрЃњ):**", min_value=1.0, max_value=300.0, value=70.0, step=0.1, key="weight_personal_page")
        height = st.number_input("­ЪЊЈ **рЃАрЃўрЃЏрЃљрЃдрЃџрЃћ (рЃАрЃЏ):**", min_value=50.0, max_value=250.0, value=170.0, step=0.1, key="height_personal_page")
        age = st.number_input("­Ъјѓ **рЃљрЃАрЃљрЃЎрЃў (рЃгрЃћрЃџрЃў):**", min_value=1, max_value=120, value=30, key="age_personal_page")

        activity_level = st.selectbox(
            "­ЪЈЃ **рЃцрЃўрЃќрЃўрЃЎрЃБрЃарЃў рЃљрЃЦрЃбрЃўрЃЋрЃЮрЃЉрЃљ:**",
            (
                "рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃарЃў (рЃЏрЃ»рЃЊрЃЮрЃЏрЃљрЃарЃћ рЃфрЃ«рЃЮрЃЋрЃарЃћрЃЉрЃљ)",
                "рЃЏрЃАрЃБрЃЉрЃБрЃЦрЃў (рЃЎрЃЋрЃўрЃарЃљрЃерЃў 1-3-рЃ»рЃћрЃа рЃЋрЃљрЃарЃ»рЃўрЃерЃў)",
                "рЃќрЃЮрЃЏрЃўрЃћрЃарЃў (рЃЎрЃЋрЃўрЃарЃљрЃерЃў 3-5-рЃ»рЃћрЃа рЃЋрЃљрЃарЃ»рЃўрЃерЃў)",
                "рЃЏрЃљрЃдрЃљрЃџрЃў (рЃЎрЃЋрЃўрЃарЃљрЃерЃў 6-7-рЃ»рЃћрЃа рЃЋрЃљрЃарЃ»рЃўрЃерЃў)",
                "рЃФрЃљрЃџрЃўрЃљрЃю рЃЏрЃљрЃдрЃљрЃџрЃў (рЃДрЃЮрЃЋрЃћрЃџрЃЊрЃдрЃўрЃБрЃарЃў, рЃўрЃюрЃбрЃћрЃюрЃАрЃўрЃБрЃарЃў рЃЋрЃљрЃарЃ»рЃўрЃерЃў)"
            ), key="activity_personal_page"
        )

        meal_frequency = st.number_input("­ЪЇй№ИЈ **рЃГрЃљрЃЏрЃўрЃА рЃАрЃўрЃ«рЃерЃўрЃарЃћ (рЃЊрЃдрЃћрЃерЃў):**", min_value=2, max_value=6, value=3, key="meal_freq_personal_page")

        body_type = st.selectbox(
            "­ЪДЇ **рЃљрЃдрЃюрЃљрЃњрЃЮрЃЉрЃљ:**",
            ("рЃњрЃљрЃЏрЃ«рЃЊрЃљрЃарЃў", "рЃАрЃљрЃерЃБрЃљрЃџрЃЮ", "рЃЏрЃАрЃБрЃЦрЃљрЃюрЃў"), key="body_type_personal_page"
        )

        goal = st.selectbox(
            "­Ъј» **рЃЎрЃЋрЃћрЃЉрЃўрЃЌрЃў рЃЏрЃўрЃќрЃљрЃюрЃў:**",
            ("рЃгрЃЮрЃюрЃўрЃА рЃЊрЃљрЃЎрЃџрЃћрЃЉрЃљ", "рЃгрЃЮрЃюрЃўрЃА рЃерЃћрЃюрЃљрЃарЃЕрЃБрЃюрЃћрЃЉрЃљ", "рЃгрЃЮрЃюрЃўрЃА рЃЏрЃЮрЃЏрЃљрЃбрЃћрЃЉрЃљ"), key="goal_personal_page"
        )

        # --- Blood type selection with both international and Georgian designations ---
        st.markdown("---")
        st.subheader("­ЪЕИ рЃАрЃўрЃАрЃ«рЃџрЃўрЃА рЃ»рЃњрЃБрЃцрЃў")
        blood_abo_options = [
            "рЃљрЃа рЃЋрЃўрЃфрЃў",
            "0 (I рЃ»рЃњрЃБрЃцрЃў)",
            "A (II рЃ»рЃњрЃБрЃцрЃў)",
            "B (III рЃ»рЃњрЃБрЃцрЃў)",
            "AB (IV рЃ»рЃњрЃБрЃцрЃў)"
        ]
        blood_abo_selection = st.selectbox(
            "**ABO рЃАрЃўрЃАрЃбрЃћрЃЏрЃљ / рЃЦрЃљрЃарЃЌрЃБрЃџрЃў рЃАрЃбрЃљрЃюрЃЊрЃљрЃарЃбрЃў:**",
            blood_abo_options, key="blood_abo_personal_page"
        )

        blood_rh = st.selectbox(
            "**Rh рЃцрЃљрЃЦрЃбрЃЮрЃарЃў:**",
            ("рЃљрЃа рЃЋрЃўрЃфрЃў", "+ (рЃЊрЃљрЃЊрЃћрЃЉрЃўрЃЌрЃў)", "- (рЃБрЃљрЃарЃДрЃЮрЃцрЃўрЃЌрЃў)"), key="blood_rh_personal_page"
        )

        # Extracting the ABO part for internal logic if needed
        blood_abo = blood_abo_selection.split(' ')[0] if blood_abo_selection != "рЃљрЃа рЃЋрЃўрЃфрЃў" else "рЃљрЃа рЃЋрЃўрЃфрЃў"
        standard_blood_group = blood_abo_selection if blood_abo_selection != "рЃљрЃа рЃЋрЃўрЃфрЃў" else "рЃБрЃфрЃюрЃЮрЃЉрЃў"

        st.markdown("---")
        calculate_button = st.button("Рюе рЃЏрЃўрЃўрЃдрЃћ рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃћрЃЉрЃў", key="calculate_personal_page")

        if calculate_button:
            bmr_val = calculate_bmr(weight, height, age, gender_personal)
            tdee_val = calculate_tdee(bmr_val, activity_level)

            daily_calories = tdee_val
            if goal == "рЃгрЃЮрЃюрЃўрЃА рЃЊрЃљрЃЎрЃџрЃћрЃЉрЃљ":
                daily_calories -= 500 # Calorie deficit
            elif goal == "рЃгрЃЮрЃюрЃўрЃА рЃЏрЃЮрЃЏрЃљрЃбрЃћрЃЉрЃљ":
                daily_calories += 500 # Calorie surplus

            st.subheader("­ЪЊі рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃърЃћрЃарЃАрЃЮрЃюрЃљрЃџрЃБрЃарЃў рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃћрЃЉрЃў")
            st.markdown("---")

            with st.expander("Рюе **рЃћрЃюрЃћрЃарЃњрЃћрЃбрЃўрЃЎрЃБрЃџрЃў рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃўрЃџрЃћрЃЉрЃљ**", expanded=True): # Default expanded for initial view
                st.write(f"рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃАрЃљрЃЉрЃљрЃќрЃўрЃАрЃЮ рЃЏрЃћрЃбрЃљрЃЉрЃЮрЃџрЃБрЃарЃў рЃЏрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃћрЃџрЃў (BMR) рЃљрЃарЃўрЃА: **{bmr_val:.2f} рЃЎрЃљрЃџрЃЮрЃарЃўрЃљ/рЃЊрЃдрЃћрЃерЃў**")
                st.write(f"рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃЊрЃдрЃўрЃБрЃарЃў рЃћрЃюрЃћрЃарЃњрЃћрЃбрЃўрЃЎрЃБрЃџрЃў рЃ«рЃљрЃарЃ»рЃў (TDEE) рЃцрЃўрЃќрЃўрЃЎрЃБрЃарЃў рЃљрЃЦрЃбрЃўрЃЋрЃЮрЃЉрЃўрЃА рЃњрЃљрЃЌрЃЋрЃљрЃџрЃўрЃАрЃгрЃўрЃюрЃћрЃЉрЃўрЃЌ рЃљрЃарЃўрЃА: **{tdee_val:.2f} рЃЎрЃљрЃџрЃЮрЃарЃўрЃљ/рЃЊрЃдрЃћрЃерЃў**")
                st.markdown(f"рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃЏрЃўрЃќрЃљрЃюрЃўрЃљ **{goal}**, рЃљрЃЏрЃўрЃбрЃЮрЃЏ рЃАрЃљрЃЋрЃљрЃарЃљрЃБрЃЊрЃЮ рЃЊрЃдрЃўрЃБрЃарЃў рЃЎрЃљрЃџрЃЮрЃарЃўрЃБрЃџрЃў рЃюрЃЮрЃарЃЏрЃљрЃљ: **{daily_calories:.2f} рЃЎрЃљрЃџрЃЮрЃарЃўрЃљ**")

            st.markdown("---")
            with st.expander("­Ъњф **рЃЏрЃљрЃЎрЃарЃЮрЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃњрЃљрЃюрЃљрЃгрЃўрЃџрЃћрЃЉрЃљ рЃЊрЃљ рЃгрЃДрЃљрЃарЃЮрЃћрЃЉрЃў**"):

                # Macronutrient ratios based on goal and body type (can be further refined)
                protein_ratio, carbs_ratio, fats_ratio = 0, 0, 0

                if goal == "рЃгрЃЮрЃюрЃўрЃА рЃЊрЃљрЃЎрЃџрЃћрЃЉрЃљ":
                    protein_ratio = 0.35 # 35% protein
                    carbs_ratio = 0.40  # 40% carbs
                    fats_ratio = 0.25   # 25% fat
                elif goal == "рЃгрЃЮрЃюрЃўрЃА рЃерЃћрЃюрЃљрЃарЃЕрЃБрЃюрЃћрЃЉрЃљ":
                    protein_ratio = 0.25
                    carbs_ratio = 0.50
                    fats_ratio = 0.25
                else: # Weight gain
                    protein_ratio = 0.30
                    carbs_ratio = 0.55
                    fats_ratio = 0.15

                protein_grams = (daily_calories * protein_ratio) / 4 # 1g protein = 4 calories
                carbs_grams = (daily_calories * carbs_ratio) / 4     # 1g carbs = 4 calories
                fats_grams = (daily_calories * fats_ratio) / 9       # 1g fat = 9 calories

                st.write(f"рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃЊрЃдрЃўрЃБрЃарЃў рЃЎрЃЋрЃћрЃЉрЃљ рЃБрЃюрЃЊрЃљ рЃерЃћрЃЊрЃњрЃћрЃЉрЃЮрЃЊрЃћрЃА рЃЊрЃљрЃљрЃ«рЃџрЃЮрЃћрЃЉрЃўрЃЌ:")
                st.markdown(f"""
                * **рЃфрЃўрЃџрЃљ:** **{protein_grams:.2f} рЃњрЃарЃљрЃЏрЃў** ({protein_ratio*100:.0f}% рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃўрЃЊрЃљрЃю)
                    * **рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃгрЃДрЃљрЃарЃЮрЃћрЃЉрЃў:** ­ЪЦЕ рЃЏрЃГрЃџрЃћ рЃ«рЃЮрЃарЃфрЃў (рЃЦрЃљрЃЌрЃЏрЃўрЃА рЃЏрЃЎрЃћрЃарЃЊрЃў, рЃўрЃюрЃЊрЃљрЃБрЃарЃў, рЃБрЃфрЃ«рЃўрЃЏрЃЮ рЃАрЃљрЃЦрЃЮрЃюрЃџрЃўрЃА рЃ«рЃЮрЃарЃфрЃў), ­ЪљЪ рЃЌрЃћрЃЋрЃќрЃў (рЃЮрЃарЃљрЃњрЃБрЃџрЃў, рЃЎрЃљрЃџрЃЏрЃљрЃ«рЃў, рЃЌрЃўрЃюрЃБрЃАрЃў), ­ЪЦџ рЃЎрЃЋрЃћрЃарЃфрЃ«рЃў, ­ЪЦЏ рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў (рЃ«рЃљрЃГрЃЮ, рЃЉрЃћрЃарЃФрЃюрЃБрЃџрЃў рЃўрЃЮрЃњрЃБрЃарЃбрЃў, рЃДрЃЋрЃћрЃџрЃў), ­Ъї▒ рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў (рЃЮрЃАрЃърЃў, рЃџрЃЮрЃЉрЃўрЃЮ, рЃЏрЃБрЃ«рЃБрЃЊрЃЮ), рЃбрЃЮрЃцрЃБ, рЃЌрЃ«рЃўрЃџрЃћрЃБрЃџрЃў.
                * **рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃў:** **{carbs_grams:.2f} рЃњрЃарЃљрЃЏрЃў** ({carbs_ratio*100:.0f}% рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃўрЃЊрЃљрЃю)
                    * **рЃгрЃДрЃљрЃарЃЮрЃћрЃЉрЃў (рЃЎрЃЮрЃЏрЃърЃџрЃћрЃЦрЃАрЃБрЃарЃў):** ­ЪїЙ рЃЏрЃЌрЃћрЃџрЃЏрЃљрЃарЃфрЃЋрЃџрЃЮрЃЋрЃљрЃюрЃў рЃърЃБрЃарЃў, рЃДрЃљрЃЋрЃўрЃАрЃцрЃћрЃарЃў рЃЉрЃарЃўрЃюрЃ»рЃў, рЃЦрЃўрЃюрЃЮрЃљ, рЃерЃЋрЃарЃўрЃљ, рЃбрЃЎрЃЉрЃўрЃџрЃў рЃЎрЃљрЃарЃбрЃЮрЃцрЃўрЃџрЃў, рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў.
                    * **рЃЏрЃљрЃарЃбрЃўрЃЋрЃў (рЃ»рЃљрЃюрЃАрЃљрЃдрЃў):** ­ЪЇј рЃ«рЃўрЃџрЃў (рЃЋрЃљрЃерЃџрЃў, рЃЉрЃљрЃюрЃљрЃюрЃў, рЃЎрЃћрЃюрЃЎрЃарЃљ).
                * **рЃфрЃ«рЃўрЃЏрЃћрЃЉрЃў:** **{fats_grams:.2f} рЃњрЃарЃљрЃЏрЃў** ({fats_ratio*100:.0f}% рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃўрЃЊрЃљрЃю)
                    * **рЃгрЃДрЃљрЃарЃЮрЃћрЃЉрЃў (рЃ»рЃљрЃюрЃАрЃљрЃдрЃў):** ­ЪЦЉ рЃљрЃЋрЃЮрЃЎрЃљрЃЊрЃЮ, ­Ъї░ рЃЌрЃ«рЃўрЃџрЃў (рЃюрЃБрЃерЃў, рЃЎрЃљрЃЎрЃљрЃџрЃў), ­ЪЦю рЃљрЃарЃљрЃЦрЃўрЃАрЃўрЃА рЃЎрЃљрЃарЃљрЃЦрЃў (рЃюрЃљрЃбрЃБрЃарЃљрЃџрЃБрЃарЃў), ­ЪљЪ рЃфрЃ«рЃўрЃЏрЃўрЃљрЃюрЃў рЃЌрЃћрЃЋрЃќрЃў, ­ЪЦБ рЃќрЃћрЃўрЃЌрЃБрЃюрЃўрЃА рЃќрЃћрЃЌрЃў, рЃЕрЃўрЃљрЃА рЃЌрЃћрЃАрЃџрЃў.
                """)

            st.markdown("---")
            with st.expander("­ЪЇй№ИЈ **рЃЎрЃЋрЃћрЃЉрЃўрЃА рЃАрЃўрЃ«рЃерЃўрЃарЃћ рЃЊрЃљ рЃарЃљрЃфрЃўрЃЮрЃюрЃћрЃЉрЃўрЃА рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃћрЃЉрЃў**"):
                st.write(f"рЃЌрЃЦрЃЋрЃћрЃю рЃњрЃўрЃарЃЕрЃћрЃЋрЃюрЃўрЃљрЃЌ рЃўрЃЎрЃЋрЃћрЃЉрЃЮрЃЌ **{meal_frequency}**-рЃ»рЃћрЃа рЃЊрЃдрЃћрЃерЃў. рЃћрЃА рЃЎрЃљрЃарЃњрЃў рЃЏрЃўрЃЊрЃњрЃЮрЃЏрЃљрЃљ рЃАрЃбрЃљрЃЉрЃўрЃџрЃБрЃарЃў рЃћрЃюрЃћрЃарЃњрЃўрЃўрЃА рЃерЃћрЃАрЃљрЃюрЃљрЃарЃЕрЃБрЃюрЃћрЃЉрЃџрЃљрЃЊ.")

                st.markdown("##### рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃћрЃЉрЃў:")
                st.markdown("""
                * **­ЪїЁ рЃАрЃљрЃБрЃќрЃЏрЃћ:**
                    * рЃерЃЋрЃарЃўрЃўрЃА рЃцрЃљрЃцрЃљ рЃЎрЃћрЃюрЃЎрЃарЃўрЃЌ рЃЊрЃљ рЃюрЃБрЃерЃўрЃЌ.
                    * рЃЮрЃЏрЃџрЃћрЃбрЃў рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃўрЃЌ рЃЊрЃљ рЃЏрЃЌрЃћрЃџрЃЏрЃљрЃарЃфрЃЋрЃџрЃЮрЃЋрЃљрЃюрЃў рЃърЃБрЃарЃўрЃЌ.
                    * рЃЉрЃћрЃарЃФрЃюрЃБрЃџрЃў рЃўрЃЮрЃњрЃБрЃарЃбрЃў рЃ«рЃўрЃџрЃўрЃЌ рЃЊрЃљ рЃњрЃарЃљрЃюрЃЮрЃџрЃўрЃЌ.
                * **Рўђ№ИЈ рЃАрЃљрЃЊрЃўрЃџрЃў:**
                    * рЃњрЃљрЃЏрЃЮрЃЏрЃфрЃ«рЃЋрЃљрЃарЃў рЃЦрЃљрЃЌрЃЏрЃўрЃА рЃЏрЃЎрЃћрЃарЃЊрЃў рЃДрЃљрЃЋрЃўрЃАрЃцрЃћрЃарЃў рЃЉрЃарЃўрЃюрЃ»рЃўрЃЌ рЃЊрЃљ рЃЉрЃарЃЮрЃЎрЃЮрЃџрЃўрЃЌ.
                    * рЃЮрЃарЃљрЃњрЃБрЃџрЃўрЃА рЃАрЃбрЃћрЃўрЃЎрЃў рЃбрЃЎрЃЉрЃўрЃџрЃў рЃЎрЃљрЃарЃбрЃЮрЃцрЃўрЃџрЃўрЃЌ рЃЊрЃљ рЃАрЃљрЃџрЃљрЃЌрЃўрЃЌ.
                    * рЃЮрЃАрЃърЃўрЃА рЃгрЃЋрЃюрЃўрЃљрЃюрЃў рЃЏрЃЌрЃћрЃџрЃЏрЃљрЃарЃфрЃЋрЃџрЃЮрЃЋрЃљрЃюрЃў рЃърЃБрЃарЃўрЃЌ.
                * **№┐й рЃЋрЃљрЃ«рЃерЃљрЃЏрЃў:**
                    * рЃерЃћрЃЏрЃгрЃЋрЃљрЃарЃў рЃўрЃюрЃЊрЃљрЃБрЃарЃў рЃЊрЃљ рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў (рЃДрЃЋрЃљрЃЋрЃўрЃџрЃЮрЃЋрЃљрЃюрЃў рЃЎрЃЮрЃЏрЃЉрЃЮрЃАрЃбрЃЮ, рЃЏрЃгрЃЋрЃљрЃюрЃћ рЃџрЃЮрЃЉрЃўрЃЮ).
                    * рЃЌрЃўрЃюрЃБрЃАрЃўрЃА рЃАрЃљрЃџрЃљрЃЌрЃў рЃЏрЃгрЃЋрЃљрЃюрЃћ рЃцрЃЮрЃЌрЃџрЃЮрЃЋрЃљрЃюрЃў рЃАрЃљрЃџрЃљрЃЌрЃўрЃЌ рЃЊрЃљ рЃљрЃЋрЃЮрЃЎрЃљрЃЊрЃЮрЃЌрЃў.
                    * рЃ«рЃљрЃГрЃЮ рЃЎрЃћрЃюрЃЎрЃарЃўрЃЌ рЃЊрЃљ рЃЌрЃ«рЃўрЃџрЃўрЃЌ.
                * **­ЪЇј рЃерЃБрЃљрЃџрЃћрЃЊрЃБрЃарЃў рЃЎрЃЋрЃћрЃЉрЃљ:**
                    * рЃ«рЃўрЃџрЃў, рЃЏрЃБрЃГрЃљ рЃЌрЃ«рЃўрЃџрЃў, рЃўрЃЮрЃњрЃБрЃарЃбрЃў, рЃАрЃбрЃљрЃцрЃўрЃџрЃЮрЃА рЃЕрЃ«рЃўрЃарЃћрЃЉрЃў рЃ░рЃБрЃЏрЃБрЃАрЃўрЃЌ.
                """)

            st.markdown("---")
            with st.expander("­ЪЈІ№ИЈРђЇРЎђ№ИЈ **рЃЎрЃЋрЃћрЃЉрЃўрЃЌрЃў рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃћрЃЉрЃў рЃљрЃЦрЃбрЃўрЃЋрЃЮрЃЉрЃўрЃА рЃЊрЃЮрЃюрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ**"):
                st.write(f"рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃљрЃЦрЃбрЃўрЃЋрЃЮрЃЉрЃўрЃА рЃЊрЃЮрЃюрЃћрЃљ: **{activity_level}**.")

                if "рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃарЃў" in activity_level:
                    st.markdown("""
                    **рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃљрЃЦрЃбрЃўрЃЋрЃЮрЃЉрЃљ (рЃЏрЃ»рЃЊрЃЮрЃЏрЃљрЃарЃћ рЃфрЃ«рЃЮрЃЋрЃарЃћрЃЉрЃљ):**
                    * **рЃцрЃЮрЃЎрЃБрЃАрЃў:** рЃЊрЃљрЃЉрЃљрЃџрЃљрЃюрЃАрЃћрЃЉрЃБрЃџрЃў, рЃљрЃЊрЃЋрЃўрЃџрЃљрЃЊ рЃЏрЃЮрЃАрЃљрЃюрЃћрЃџрЃћрЃЉрЃћрЃџрЃў рЃАрЃљрЃЎрЃЋрЃћрЃЉрЃў, рЃЏрЃљрЃдрЃљрЃџрЃў рЃЉрЃЮрЃГрЃЎрЃЮрЃЋрЃљрЃюрЃўрЃЌ. рЃЏрЃЮрЃћрЃарЃўрЃЊрЃћрЃЌ рЃГрЃљрЃарЃЉ рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃА.
                    * **рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃўрЃљ:**
                        * **рЃАрЃљрЃБрЃќрЃЏрЃћ:** рЃерЃЋрЃарЃўрЃўрЃА рЃцрЃљрЃцрЃљ рЃ«рЃўрЃџрЃўрЃЌ, рЃљрЃю рЃЎрЃЋрЃћрЃарЃфрЃ«рЃўрЃА рЃфрЃўрЃџрЃўрЃА рЃЮрЃЏрЃџрЃћрЃбрЃў рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃўрЃЌ.
                        * **рЃАрЃљрЃЊрЃўрЃџрЃў:** рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃўрЃА рЃАрЃљрЃџрЃљрЃЌрЃў рЃЦрЃљрЃЌрЃЏрЃўрЃА рЃњрЃарЃўрЃџрЃќрЃћ рЃЏрЃЮрЃЏрЃќрЃљрЃЊрЃћрЃЉрЃБрЃџрЃў рЃЏрЃЎрЃћрЃарЃЊрЃўрЃЌ рЃљрЃю рЃЌрЃћрЃЋрЃќрЃўрЃЌ. рЃЏрЃАрЃБрЃЉрЃБрЃЦрЃў рЃАрЃБрЃърЃћрЃЉрЃў.
                        * **рЃЋрЃљрЃ«рЃерЃљрЃЏрЃў:** рЃЮрЃарЃЌрЃЦрЃџрЃќрЃћ рЃЏрЃЮрЃ«рЃљрЃарЃерЃБрЃџрЃў рЃЌрЃћрЃЋрЃќрЃў рЃљрЃю рЃЏрЃГрЃџрЃћ рЃ«рЃЮрЃарЃфрЃў, рЃЉрЃћрЃЋрЃарЃў рЃЏрЃгрЃЋрЃљрЃюрЃћ рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃўрЃЌ.
                        * **рЃерЃБрЃљрЃџрЃћрЃЊрЃБрЃарЃў рЃЎрЃЋрЃћрЃЉрЃљ:** рЃ«рЃўрЃџрЃў, рЃўрЃЮрЃњрЃБрЃарЃбрЃў.
                    * **рЃЏрЃЮрЃћрЃарЃўрЃЊрЃћрЃЌ:** рЃбрЃЎрЃЉрЃўрЃџрЃћрЃБрЃџрЃў, рЃфрЃ«рЃўрЃЏрЃўрЃљрЃюрЃў рЃАрЃљрЃЎрЃЋрЃћрЃЉрЃў, рЃњрЃљрЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃБрЃџрЃў рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃў (рЃЌрЃћрЃЌрЃарЃў рЃърЃБрЃарЃў, рЃЏрЃљрЃЎрЃљрЃарЃЮрЃюрЃў).
                    """)
                elif "рЃЏрЃАрЃБрЃЉрЃБрЃЦрЃў" in activity_level:
                    st.markdown("""
                    **рЃЏрЃАрЃБрЃЉрЃБрЃЦрЃў рЃљрЃЦрЃбрЃўрЃЋрЃЮрЃЉрЃљ (рЃЎрЃЋрЃўрЃарЃљрЃерЃў 1-3-рЃ»рЃћрЃа рЃЋрЃљрЃарЃ»рЃўрЃерЃў):**
                    * **рЃцрЃЮрЃЎрЃБрЃАрЃў:** рЃЎрЃљрЃарЃњрЃў рЃЉрЃљрЃџрЃљрЃюрЃАрЃў рЃЏрЃљрЃЎрЃарЃЮрЃћрЃџрЃћрЃЏрЃћрЃюрЃбрЃћрЃЉрЃА рЃерЃЮрЃарЃўрЃА. рЃљрЃЦрЃбрЃўрЃБрЃарЃў рЃфрЃ«рЃЮрЃЋрЃарЃћрЃЉрЃўрЃАрЃЌрЃЋрЃўрЃА рЃАрЃљрЃГрЃўрЃарЃЮ рЃћрЃюрЃћрЃарЃњрЃўрЃљ.
                    * **рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃўрЃљ:**
                        * **рЃАрЃљрЃБрЃќрЃЏрЃћ:** рЃЏрЃЌрЃћрЃџрЃЏрЃљрЃарЃфрЃЋрЃџрЃЮрЃЋрЃљрЃюрЃў рЃцрЃљрЃцрЃћрЃЉрЃў, рЃЎрЃЋрЃћрЃарЃфрЃ«рЃў, рЃЉрЃћрЃарЃФрЃюрЃБрЃџрЃў рЃўрЃЮрЃњрЃБрЃарЃбрЃў.
                        * **рЃАрЃљрЃЊрЃўрЃџрЃў:** рЃЏрЃГрЃџрЃћ рЃ«рЃЮрЃарЃфрЃў/рЃЌрЃћрЃЋрЃќрЃў, рЃДрЃљрЃЋрЃўрЃАрЃцрЃћрЃарЃў рЃЉрЃарЃўрЃюрЃ»рЃў/рЃЦрЃўрЃюрЃЮрЃљ, рЃЉрЃћрЃЋрЃарЃў рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў.
                        * **рЃЋрЃљрЃ«рЃерЃљрЃЏрЃў:** рЃЏрЃАрЃБрЃЉрЃБрЃЦрЃў рЃфрЃўрЃџрЃЮрЃЋрЃљрЃюрЃў рЃЎрЃЋрЃћрЃЉрЃљ рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃўрЃЌ.
                        * **рЃерЃБрЃљрЃџрЃћрЃЊрЃБрЃарЃў рЃЎрЃЋрЃћрЃЉрЃљ:** рЃЌрЃ«рЃўрЃџрЃў, рЃ«рЃўрЃџрЃў, рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃўрЃА рЃЕрЃ«рЃўрЃарЃћрЃЉрЃў.
                    * **рЃДрЃБрЃарЃљрЃЊрЃдрЃћрЃЉрЃљ рЃЏрЃўрЃљрЃЦрЃфрЃўрЃћрЃЌ:** рЃЋрЃљрЃарЃ»рЃўрЃерЃўрЃА рЃгрЃўрЃю (1-2 рЃАрЃЌ) рЃЏрЃўрЃўрЃдрЃћрЃЌ рЃЏрЃфрЃўрЃарЃћ рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃўрЃЌ рЃАрЃгрЃарЃљрЃцрЃў рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃў (рЃЉрЃљрЃюрЃљрЃюрЃў), рЃЋрЃљрЃарЃ»рЃўрЃерЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ - рЃфрЃўрЃџрЃљ рЃЊрЃљ рЃЎрЃЮрЃЏрЃърЃџрЃћрЃЦрЃАрЃБрЃарЃў рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃў.
                    """)
                elif "рЃќрЃЮрЃЏрЃўрЃћрЃарЃў" in activity_level:
                    st.markdown("""
                    **рЃќрЃЮрЃЏрЃўрЃћрЃарЃў рЃљрЃЦрЃбрЃўрЃЋрЃЮрЃЉрЃљ (рЃЎрЃЋрЃўрЃарЃљрЃерЃў 3-5-рЃ»рЃћрЃа рЃЋрЃљрЃарЃ»рЃўрЃерЃў):**
                    * **рЃцрЃЮрЃЎрЃБрЃАрЃў:** рЃњрЃљрЃќрЃарЃЊрЃўрЃџрЃў рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃўрЃАрЃљ рЃЊрЃљ рЃфрЃўрЃџрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃљ рЃЎрЃБрЃюрЃЌрЃћрЃЉрЃўрЃА рЃљрЃдрЃЊрЃњрЃћрЃюрЃўрЃАрЃљ рЃЊрЃљ рЃћрЃюрЃћрЃарЃњрЃўрЃўрЃА рЃерЃћрЃАрЃљрЃюрЃљрЃарЃЕрЃБрЃюрЃћрЃЉрЃџрЃљрЃЊ.
                    * **рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃўрЃљ:**
                        * **рЃАрЃљрЃБрЃќрЃЏрЃћ:** рЃерЃЋрЃарЃўрЃўрЃА рЃцрЃљрЃцрЃљ рЃърЃарЃЮрЃбрЃћрЃўрЃюрЃўрЃА рЃцрЃ«рЃЋрЃюрЃўрЃџрЃўрЃЌ рЃљрЃю рЃЎрЃЋрЃћрЃарЃфрЃ«рЃўрЃЌ, рЃЏрЃЌрЃћрЃџрЃЏрЃљрЃарЃфрЃЋрЃџрЃЮрЃЋрЃљрЃюрЃў рЃърЃБрЃарЃў.
                        * **рЃАрЃљрЃЊрЃўрЃџрЃў:** рЃЦрЃљрЃЌрЃљрЃЏрЃў/рЃЌрЃћрЃЋрЃќрЃў/рЃАрЃљрЃЦрЃЮрЃюрЃџрЃўрЃА рЃ«рЃЮрЃарЃфрЃў, рЃЏрЃћрЃбрЃў рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃўрЃЌ рЃДрЃљрЃЋрЃўрЃАрЃцрЃћрЃарЃў рЃЉрЃарЃўрЃюрЃ»рЃў/рЃбрЃЎрЃЉрЃўрЃџрЃў рЃЎрЃљрЃарЃбрЃЮрЃцрЃўрЃџрЃў, рЃБрЃљрЃЏрЃарЃљрЃЋрЃў рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў.
                        * **рЃЋрЃљрЃ«рЃерЃљрЃЏрЃў:** рЃфрЃўрЃџрЃЮрЃЋрЃљрЃюрЃў рЃЎрЃЋрЃћрЃЉрЃљ (рЃЮрЃарЃљрЃњрЃБрЃџрЃў, рЃўрЃюрЃЊрЃљрЃБрЃарЃў) рЃЊрЃљ рЃЏрЃгрЃЋрЃљрЃюрЃћ рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў.
                        * **рЃерЃБрЃљрЃџрЃћрЃЊрЃБрЃарЃў рЃЎрЃЋрЃћрЃЉрЃљ:** рЃърЃарЃЮрЃбрЃћрЃўрЃю рЃЉрЃљрЃарЃў, рЃ«рЃљрЃГрЃЮ, рЃЌрЃ«рЃўрЃџрЃў, рЃ«рЃўрЃџрЃў.
                    * **рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃўрЃљ:** рЃЋрЃљрЃарЃ»рЃўрЃерЃўрЃА рЃерЃћрЃЏрЃЊрЃњрЃЮрЃЏрЃў рЃЎрЃЋрЃћрЃЉрЃљ рЃфрЃўрЃџрЃћрЃЉрЃўрЃЌрЃљ рЃЊрЃљ рЃЎрЃЮрЃЏрЃърЃџрЃћрЃЦрЃАрЃБрЃарЃў рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃўрЃЌ (рЃЏрЃљрЃњ. рЃЦрЃљрЃЌрЃљрЃЏрЃў рЃЊрЃљ рЃЉрЃарЃўрЃюрЃ»рЃў) рЃЎрЃБрЃюрЃЌрЃћрЃЉрЃўрЃА рЃАрЃгрЃарЃљрЃцрЃў рЃљрЃдрЃЊрЃњрЃћрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА.
                    """)
                elif "рЃЏрЃљрЃдрЃљрЃџрЃў" in activity_level:
                    st.markdown("""
                    **рЃЏрЃљрЃдрЃљрЃџрЃў рЃљрЃЦрЃбрЃўрЃЋрЃЮрЃЉрЃљ (рЃЎрЃЋрЃўрЃарЃљрЃерЃў 6-7-рЃ»рЃћрЃа рЃЋрЃљрЃарЃ»рЃўрЃерЃў):**
                    * **рЃцрЃЮрЃЎрЃБрЃАрЃў:** рЃЏрЃљрЃдрЃљрЃџрЃў рЃЎрЃљрЃџрЃЮрЃарЃўрЃБрЃџрЃў рЃЏрЃўрЃдрЃћрЃЉрЃљ, рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃў, рЃарЃЮрЃњрЃЮрЃарЃф рЃћрЃюрЃћрЃарЃњрЃўрЃўрЃА рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃў рЃгрЃДрЃљрЃарЃЮ, рЃЊрЃљ рЃЏрЃљрЃдрЃљрЃџрЃў рЃфрЃўрЃџрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃљ рЃЎрЃБрЃюрЃЌрЃћрЃЉрЃўрЃА рЃќрЃарЃЊрЃўрЃАрЃљ рЃЊрЃљ рЃљрЃдрЃЊрЃњрЃћрЃюрЃўрЃАрЃЌрЃЋрЃўрЃА.
                    * **рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃўрЃљ:**
                        * **рЃАрЃљрЃБрЃќрЃЏрЃћ:** рЃЊрЃўрЃЊрЃў рЃърЃЮрЃарЃфрЃўрЃљ рЃерЃЋрЃарЃўрЃљ рЃЌрЃ«рЃўрЃџрЃўрЃЌ, рЃЎрЃћрЃюрЃЎрЃарЃўрЃЌ, рЃърЃарЃЮрЃбрЃћрЃўрЃюрЃўрЃА рЃцрЃ«рЃЋрЃюрЃўрЃџрЃўрЃЌ. рЃЮрЃЏрЃџрЃћрЃбрЃў рЃЉрЃћрЃЋрЃарЃў рЃЎрЃЋрЃћрЃарЃфрЃ«рЃўрЃЌ.
                        * **рЃАрЃљрЃЊрЃўрЃџрЃў:** рЃЮрЃарЃЏрЃљрЃњрЃў рЃърЃЮрЃарЃфрЃўрЃљ рЃЏрЃГрЃџрЃћ рЃ«рЃЮрЃарЃфрЃў/рЃЌрЃћрЃЋрЃќрЃў, рЃЊрЃўрЃЊрЃў рЃърЃЮрЃарЃфрЃўрЃљ рЃЉрЃарЃўрЃюрЃ»рЃў/рЃЎрЃљрЃарЃбрЃЮрЃцрЃўрЃџрЃў/рЃърЃљрЃАрЃбрЃљ, рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў.
                        * **рЃЋрЃљрЃ«рЃерЃљрЃЏрЃў:** рЃфрЃўрЃџрЃўрЃЌ рЃЏрЃЊрЃўрЃЊрЃљрЃарЃў рЃЊрЃљ рЃЎрЃЮрЃЏрЃърЃџрЃћрЃЦрЃАрЃБрЃарЃў рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃфрЃЋрЃћрЃџрЃў рЃЎрЃЋрЃћрЃЉрЃљ (рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃљрЃЊ, рЃАрЃљрЃЦрЃЮрЃюрЃџрЃўрЃА рЃ«рЃЮрЃарЃфрЃў рЃгрЃўрЃгрЃўрЃЉрЃБрЃарЃљрЃЌрЃў).
                        * **рЃерЃБрЃљрЃџрЃћрЃЊрЃБрЃарЃў рЃЎрЃЋрЃћрЃЉрЃљ:** рЃ«рЃўрЃџрЃў, рЃърЃарЃЮрЃбрЃћрЃўрЃю рЃерЃћрЃўрЃЎрЃў, рЃАрЃћрЃюрЃЊрЃЋрЃўрЃЕрЃћрЃЉрЃў рЃЏрЃЌрЃћрЃџрЃЏрЃљрЃарЃфрЃЋрЃџрЃЮрЃЋрЃљрЃюрЃў рЃърЃБрЃарЃўрЃЌ.
                    * **рЃњрЃљрЃюрЃАрЃљрЃЎрЃБрЃЌрЃарЃћрЃЉрЃБрЃџрЃў рЃДрЃБрЃарЃљрЃЊрЃдрЃћрЃЉрЃљ:** рЃЋрЃљрЃарЃ»рЃўрЃерЃўрЃА рЃгрЃўрЃю рЃЊрЃљ рЃерЃћрЃЏрЃЊрЃњрЃЮрЃЏ рЃЎрЃЋрЃћрЃЉрЃљрЃА. рЃерЃћрЃАрЃљрЃФрЃџрЃЮрЃљ рЃАрЃљрЃГрЃўрЃарЃЮ рЃњрЃљрЃ«рЃЊрЃћрЃА рЃАрЃърЃЮрЃарЃбрЃБрЃџрЃў рЃЊрЃљрЃюрЃљрЃЏрЃљрЃбрЃћрЃЉрЃў (рЃЎрЃарЃћрЃљрЃбрЃўрЃюрЃў, BCAA).
                    """)
                elif "рЃФрЃљрЃџрЃўрЃљрЃю рЃЏрЃљрЃдрЃљрЃџрЃў" in activity_level:
                    st.markdown("""
                    **рЃФрЃљрЃџрЃўрЃљрЃю рЃЏрЃљрЃдрЃљрЃџрЃў рЃљрЃЦрЃбрЃўрЃЋрЃЮрЃЉрЃљ (рЃДрЃЮрЃЋрЃћрЃџрЃЊрЃдрЃўрЃБрЃарЃў, рЃўрЃюрЃбрЃћрЃюрЃАрЃўрЃБрЃарЃў рЃЋрЃљрЃарЃ»рЃўрЃерЃў):**
                    * **рЃцрЃЮрЃЎрЃБрЃАрЃў:** рЃФрЃљрЃџрЃўрЃљрЃю рЃЏрЃљрЃдрЃљрЃџрЃў рЃЎрЃљрЃџрЃЮрЃарЃўрЃБрЃџрЃў рЃЏрЃўрЃдрЃћрЃЉрЃљ, рЃћрЃюрЃћрЃарЃњрЃўрЃўрЃА рЃЏрЃБрЃЊрЃЏрЃўрЃЋрЃў рЃерЃћрЃЋрЃАрЃћрЃЉрЃљ рЃЊрЃљ рЃЎрЃБрЃюрЃЌрЃћрЃЉрЃўрЃА рЃЏрЃљрЃЦрЃАрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃљрЃдрЃЊрЃњрЃћрЃюрЃљ.
                    * **рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃўрЃљ:**
                        * **рЃЏрЃарЃљрЃЋрЃљрЃџрЃ»рЃћрЃарЃљрЃЊрЃў рЃЎрЃЋрЃћрЃЉрЃљ:** 5-6 рЃЊрЃўрЃЊрЃў рЃЎрЃЋрЃћрЃЉрЃљ рЃЊрЃдрЃћрЃерЃў, рЃЏрЃЊрЃўрЃЊрЃљрЃарЃў рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃўрЃЌрЃљ рЃЊрЃљ рЃфрЃўрЃџрЃћрЃЉрЃўрЃЌ.
                        * **рЃЎрЃЋрЃћрЃЉрЃўрЃА рЃЏрЃљрЃњрЃљрЃџрЃўрЃЌрЃћрЃЉрЃў:** рЃарЃЌрЃБрЃџрЃў рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃў (рЃЉрЃарЃўрЃюрЃ»рЃў, рЃбрЃЎрЃЉрЃўрЃџрЃў рЃЎрЃљрЃарЃбрЃЮрЃцрЃўрЃџрЃў, рЃърЃљрЃАрЃбрЃљ), рЃЏрЃГрЃџрЃћ рЃфрЃўрЃџрЃћрЃЉрЃў (рЃЦрЃљрЃЌрЃљрЃЏрЃў, рЃўрЃюрЃЊрЃљрЃБрЃарЃў, рЃАрЃљрЃЦрЃЮрЃюрЃџрЃўрЃА рЃ«рЃЮрЃарЃфрЃў, рЃЌрЃћрЃЋрЃќрЃў), рЃ»рЃљрЃюрЃАрЃљрЃдрЃў рЃфрЃ«рЃўрЃЏрЃћрЃЉрЃў (рЃљрЃЋрЃЮрЃЎрЃљрЃЊрЃЮ, рЃЌрЃ«рЃўрЃџрЃў).
                        * **рЃЏрЃБрЃЊрЃЏрЃўрЃЋрЃў рЃерЃћрЃЋрЃАрЃћрЃЉрЃљ:** рЃЋрЃљрЃарЃ»рЃўрЃерЃўрЃА рЃЊрЃарЃЮрЃА рЃЊрЃљ рЃЏрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ рЃћрЃџрЃћрЃЦрЃбрЃарЃЮрЃџрЃўрЃбрЃћрЃЉрЃўрЃЌрЃљ рЃЊрЃљ рЃАрЃгрЃарЃљрЃцрЃў рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃўрЃЌ рЃЏрЃЊрЃўрЃЊрЃљрЃарЃў рЃАрЃљрЃАрЃЏрЃћрЃџрЃћрЃЉрЃў.
                    * **рЃАрЃърЃћрЃфрЃўрЃљрЃџрЃБрЃарЃў рЃЏрЃўрЃЊрЃњрЃЮрЃЏрЃљ:** рЃерЃћрЃАрЃљрЃФрЃџрЃЮрЃљ рЃАрЃљрЃГрЃўрЃарЃЮ рЃњрЃљрЃ«рЃЊрЃћрЃА рЃърЃарЃЮрЃцрЃћрЃАрЃўрЃЮрЃюрЃљрЃџрЃў рЃАрЃърЃЮрЃарЃбрЃБрЃџрЃў рЃЊрЃўрЃћрЃбрЃЮрЃџрЃЮрЃњрЃўрЃА рЃЎрЃЮрЃюрЃАрЃБрЃџрЃбрЃљрЃфрЃўрЃљ. рЃЊрЃљрЃюрЃљрЃЏрЃљрЃбрЃћрЃЉрЃўрЃА рЃарЃЮрЃџрЃў (рЃЎрЃарЃћрЃљрЃбрЃўрЃюрЃў, рЃърЃарЃЮрЃбрЃћрЃўрЃюрЃў, рЃњрЃћрЃўрЃюрЃћрЃарЃћрЃЉрЃў) рЃБрЃцрЃарЃЮ рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃ«рЃЊрЃћрЃЉрЃљ.
                    """)

            st.markdown("---")
            with st.expander("Рџќ№ИЈ **рЃћрЃарЃЌрЃ»рЃћрЃарЃљрЃЊрЃў рЃЎрЃЋрЃћрЃЉрЃўрЃА рЃЏрЃўрЃљрЃ«рЃџрЃЮрЃћрЃЉрЃўрЃЌрЃў рЃюрЃЮрЃарЃЏрЃљ**"):
                st.markdown(f"""
                рЃЌрЃЦрЃЋрЃћрЃюрЃў **{daily_calories:.0f} рЃЎрЃљрЃџрЃЮрЃарЃўрЃўрЃА** рЃњрЃљрЃЌрЃЋрЃљрЃџрЃўрЃАрЃгрЃўрЃюрЃћрЃЉрЃўрЃЌ рЃЊрЃљ **{meal_frequency} рЃЎрЃЋрЃћрЃЉрЃљрЃќрЃћ** рЃњрЃљрЃЊрЃљрЃюрЃљрЃгрЃўрЃџрЃћрЃЉрЃўрЃЌ, рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃЎрЃЋрЃћрЃЉрЃљ рЃБрЃюрЃЊрЃљ рЃўрЃДрЃЮрЃА рЃЊрЃљрЃљрЃ«рЃџрЃЮрЃћрЃЉрЃўрЃЌ **{daily_calories / meal_frequency:.0f} рЃЎрЃљрЃџрЃЮрЃарЃўрЃљ**.
                рЃАрЃљрЃерЃБрЃљрЃџрЃЮ рЃћрЃарЃЌрЃ»рЃћрЃарЃљрЃЊрЃў рЃЎрЃЋрЃћрЃЉрЃљ рЃерЃћрЃўрЃФрЃџрЃћрЃЉрЃљ рЃерЃћрЃўрЃфрЃљрЃЋрЃЊрЃћрЃА:
                * **рЃфрЃўрЃџрЃљ:** **{protein_grams / meal_frequency:.0f} рЃњрЃарЃљрЃЏрЃў** (рЃЊрЃљрЃљрЃ«рЃџ. рЃ«рЃћрЃџрЃўрЃАрЃњрЃБрЃџрЃўрЃА рЃќрЃЮрЃЏрЃўрЃА рЃърЃЮрЃарЃфрЃўрЃљ рЃЦрЃљрЃЌрЃљрЃЏрЃў/рЃЌрЃћрЃЋрЃќрЃў, рЃљрЃю 2-3 рЃЎрЃЋрЃћрЃарЃфрЃ«рЃў).
                * **рЃюрЃљрЃ«рЃерЃўрЃарЃгрЃДрЃџрЃћрЃЉрЃў:** **{carbs_grams / meal_frequency:.0f} рЃњрЃарЃљрЃЏрЃў** (рЃЊрЃљрЃљрЃ«рЃџ. рЃЏрЃБрЃГрЃўрЃА рЃќрЃЮрЃЏрЃўрЃА рЃърЃЮрЃарЃфрЃўрЃљ рЃЉрЃарЃўрЃюрЃ»рЃў/рЃЦрЃўрЃюрЃЮрЃљ, рЃљрЃю 1 рЃАрЃљрЃерЃБрЃљрЃџрЃЮ рЃЎрЃљрЃарЃбрЃЮрЃцрЃўрЃџрЃў).
                * **рЃфрЃ«рЃўрЃЏрЃћрЃЉрЃў:** **{fats_grams / meal_frequency:.0f} рЃњрЃарЃљрЃЏрЃў** (рЃЊрЃљрЃљрЃ«рЃџ. рЃфрЃћрЃарЃљ рЃЌрЃўрЃЌрЃўрЃА рЃќрЃЮрЃЏрЃўрЃА рЃърЃЮрЃарЃфрЃўрЃљ рЃљрЃЋрЃЮрЃЎрЃљрЃЊрЃЮ/рЃЌрЃ«рЃўрЃџрЃў).
                * **рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў:** ­ЪЦд­ЪЦЋ рЃўрЃЏрЃЊрЃћрЃюрЃў, рЃарЃљрЃЏрЃЊрЃћрЃюрЃўрЃф рЃњрЃАрЃБрЃарЃЌ!
                """)

            st.markdown("---")
            with st.expander("­Ъї▒ **рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃЏрЃўрЃюрЃћрЃарЃљрЃџрЃћрЃЉрЃў рЃЊрЃљ рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃћрЃЉрЃў: рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃў рЃгрЃДрЃљрЃарЃЮрЃћрЃЉрЃў**"):
                st.markdown("""
                * **рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў C:** ­ЪЇі рЃфрЃўрЃбрЃарЃБрЃАрЃћрЃЉрЃў, ­ЪЦЮ рЃЎрЃўрЃЋрЃў, ­ЪЇЊ рЃЏрЃљрЃарЃгрЃДрЃЋрЃў, ­ЪїХ№ИЈ рЃгрЃўрЃгрЃљрЃЎрЃљ, рЃЉрЃарЃЮрЃЎрЃЮрЃџрЃў.
                * **рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў D:** Рўђ№ИЈ рЃЏрЃќрЃўрЃА рЃАрЃўрЃюрЃљрЃЌрЃџрЃћ, ­ЪљЪ рЃфрЃ«рЃўрЃЏрЃўрЃљрЃюрЃў рЃЌрЃћрЃЋрЃќрЃў, ­ЪЦџ рЃЎрЃЋрЃћрЃарЃфрЃ«рЃўрЃА рЃњрЃБрЃџрЃў.
                * **рЃарЃЎрЃўрЃюрЃљ:** ­ЪЦЕ рЃгрЃўрЃЌрЃћрЃџрЃў рЃ«рЃЮрЃарЃфрЃў, ­ЪЇЌ рЃЦрЃљрЃЌрЃљрЃЏрЃў, ­ЪљЪ рЃЌрЃћрЃЋрЃќрЃў, ­Ъї▒ рЃЮрЃАрЃърЃў, рЃўрЃАрЃърЃљрЃюрЃљрЃ«рЃў, рЃњрЃЮрЃњрЃарЃўрЃА рЃЌрЃћрЃАрЃџрЃў.
                * **рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў:** ­ЪЦЏ рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў, ­Ъї▒ рЃўрЃАрЃърЃљрЃюрЃљрЃ«рЃў, рЃЉрЃарЃЮрЃЎрЃЮрЃџрЃў, рЃбрЃЮрЃцрЃБ.
                * **рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў:** ­Ъї░ рЃЌрЃ«рЃўрЃџрЃў, ­Ъї╗ рЃЌрЃћрЃАрЃџрЃћрЃБрЃџрЃў, ­Ъї▒ рЃўрЃАрЃърЃљрЃюрЃљрЃ«рЃў, рЃљрЃЋрЃЮрЃЎрЃљрЃЊрЃЮ, рЃерЃљрЃЋрЃў рЃерЃЮрЃЎрЃЮрЃџрЃљрЃЊрЃў.
                * **рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў:** ­ЪЇї рЃЉрЃљрЃюрЃљрЃюрЃў, ­ЪЦћ рЃЎрЃљрЃарЃбрЃЮрЃцрЃўрЃџрЃў, ­ЪЦЉ рЃљрЃЋрЃЮрЃЎрЃљрЃЊрЃЮ, ­Ъї▒ рЃўрЃАрЃърЃљрЃюрЃљрЃ«рЃў, рЃџрЃЮрЃЉрЃўрЃЮ.
                * **рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў B12:** ­ЪЦЕ рЃ«рЃЮрЃарЃфрЃў, ­ЪљЪ рЃЌрЃћрЃЋрЃќрЃў, ­ЪЦџ рЃЎрЃЋрЃћрЃарЃфрЃ«рЃў, ­ЪЦЏ рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў.
                * **рЃцрЃЮрЃџрЃўрЃБрЃЏрЃўрЃА рЃЏрЃЪрЃљрЃЋрЃљ:** ­ЪЦг рЃЏрЃгрЃЋрЃљрЃюрЃћ рЃцрЃЮрЃЌрЃџрЃЮрЃЋрЃљрЃюрЃў рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў, рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў, рЃфрЃўрЃбрЃарЃБрЃАрЃћрЃЉрЃў.
                """)

            st.markdown("---")
            with st.expander("­ЪњД **рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌрЃў рЃ»рЃљрЃюрЃАрЃљрЃдрЃў рЃЕрЃЋрЃћрЃЋрЃћрЃЉрЃў**"):
                st.markdown("""
                * **рЃгрЃДрЃџрЃўрЃА рЃЏрЃўрЃдрЃћрЃЉрЃљ:** рЃЊрЃљрЃџрЃўрЃћрЃЌ **2-2.5 рЃџрЃўрЃбрЃарЃў** рЃгрЃДрЃљрЃџрЃў рЃЊрЃдрЃћрЃерЃў.
                * **рЃФрЃўрЃџрЃў:** рЃћрЃфрЃљрЃЊрЃћрЃЌ рЃњрЃћрЃФрЃўрЃюрЃЮрЃЌ **7-9 рЃАрЃљрЃљрЃЌрЃў**.
                * **рЃАрЃбрЃарЃћрЃАрЃўрЃА рЃЏрЃљрЃарЃЌрЃЋрЃљ:** рЃўрЃърЃЮрЃЋрЃћрЃЌ рЃЌрЃЦрЃЋрЃћрЃюрЃЌрЃЋрЃўрЃА рЃерЃћрЃАрЃљрЃцрЃћрЃарЃўрЃАрЃў рЃњрЃќрЃћрЃЉрЃў (рЃўрЃЮрЃњрЃљ, рЃЏрЃћрЃЊрЃўрЃбрЃљрЃфрЃўрЃљ, рЃњрЃљрЃАрЃћрЃўрЃарЃюрЃћрЃЉрЃљ).
                * **рЃцрЃўрЃќрЃўрЃЎрЃБрЃарЃў рЃљрЃЦрЃбрЃўрЃЋрЃЮрЃЉрЃљ:** рЃарЃћрЃњрЃБрЃџрЃљрЃарЃБрЃџрЃў рЃЋрЃљрЃарЃ»рЃўрЃерЃў рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃћрЃџрЃўрЃљ.
                * **рЃ»рЃљрЃюрЃАрЃљрЃдрЃў рЃљрЃарЃЕрЃћрЃЋрЃљрЃюрЃў:** рЃерЃћрЃќрЃдрЃБрЃЊрЃћрЃЌ рЃњрЃљрЃЊрЃљрЃЏрЃБрЃерЃљрЃЋрЃћрЃЉрЃБрЃџрЃў, рЃерЃљрЃЦрЃарЃўрЃљрЃюрЃў рЃЊрЃљ рЃфрЃ«рЃўрЃЏрЃћрЃЉрЃўрЃЌ рЃЏрЃЊрЃўрЃЊрЃљрЃарЃў рЃАрЃљрЃЎрЃЋрЃћрЃЉрЃў.
                * **рЃЏрЃарЃљрЃЋрЃљрЃџрЃцрЃћрЃарЃЮрЃЋрЃюрЃћрЃЉрЃљ:** рЃЏрЃўрЃўрЃарЃЌрЃЋрЃўрЃЌ рЃЏрЃарЃљрЃЋрЃљрЃџрЃцрЃћрЃарЃЮрЃЋрЃљрЃюрЃў рЃАрЃљрЃЎрЃЋрЃћрЃЉрЃў.
                * **рЃЏрЃЮрЃБрЃАрЃЏрЃўрЃюрЃћрЃЌ рЃАрЃ«рЃћрЃБрЃџрЃА:** рЃўрЃЎрЃЋрЃћрЃЉрЃћрЃЌ рЃерЃўрЃЏрЃерЃўрЃџрЃўрЃА рЃЊрЃарЃЮрЃА, рЃерЃћрЃгрЃДрЃЋрЃўрЃбрЃћрЃЌ рЃЊрЃљрЃюрЃљрЃДрЃарЃћрЃЉрЃўрЃАрЃљрЃА.
                """)

            # --- Blood type specific advice (general) ---
            selected_blood_type_display = standard_blood_group
            if blood_rh != "рЃљрЃа рЃЋрЃўрЃфрЃў":
                selected_blood_type_display += f" {blood_rh}"

            if blood_abo != "рЃљрЃа рЃЋрЃўрЃфрЃў" and "рЃљрЃа рЃЋрЃўрЃфрЃў" not in blood_abo_selection:
                st.markdown("---")
                with st.expander(f"­ЪЕИ **рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃљ рЃАрЃўрЃАрЃ«рЃџрЃўрЃА рЃ»рЃњрЃБрЃцрЃўрЃАрЃЌрЃЋрЃўрЃА ({selected_blood_type_display})**"):
                    if "0" in blood_abo: # 0 (I Group)
                        st.write("""
                        **рЃ»рЃњрЃБрЃцрЃў 0 (I):** рЃќрЃЮрЃњрЃљрЃЊрЃў рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃўрЃЌ, рЃљрЃЏ рЃ»рЃњрЃБрЃцрЃўрЃАрЃЌрЃЋрЃўрЃА рЃ«рЃерЃўрЃарЃљрЃЊ рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃўрЃљ **рЃЏрЃљрЃдрЃљрЃџрЃфрЃўрЃџрЃЮрЃЋрЃљрЃюрЃў рЃЊрЃўрЃћрЃбрЃљ** рЃЏрЃГрЃџрЃћ рЃ«рЃЮрЃарЃфрЃўрЃЌ, рЃцрЃарЃўрЃюрЃЋрЃћрЃџрЃўрЃЌ, рЃЌрЃћрЃЋрЃќрЃўрЃЌ.
                        * **рЃБрЃърЃўрЃарЃљрЃбрЃћрЃАрЃЮрЃЉрЃљ:** ­ЪЦЕ рЃгрЃўрЃЌрЃћрЃџрЃў рЃ«рЃЮрЃарЃфрЃў (рЃБрЃфрЃ«рЃўрЃЏрЃЮ), ­ЪЇЌ рЃЦрЃљрЃЌрЃљрЃЏрЃў, ­ЪљЪ рЃЌрЃћрЃЋрЃќрЃў, рЃ«рЃўрЃџрЃў, рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў.
                        * **рЃерЃћрЃќрЃдрЃБрЃЊрЃћрЃЌ:** ­ЪЦЏ рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў, ­ЪїЙ рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃБрЃџрЃў (рЃ«рЃЮрЃарЃЉрЃљрЃџрЃў), ­ЪЦћ рЃЎрЃљрЃарЃбрЃЮрЃцрЃўрЃџрЃў.
                        """)
                    elif "A" in blood_abo: # A (II Group)
                        st.write("""
                        **рЃ»рЃњрЃБрЃцрЃў A (II):** рЃАрЃљрЃАрЃљрЃарЃњрЃћрЃЉрЃџрЃЮрЃљ рЃФрЃўрЃарЃўрЃЌрЃљрЃЊрЃљрЃЊ **рЃЏрЃфрЃћрЃюрЃљрЃарЃћрЃБрЃџрЃў рЃЎрЃЋрЃћрЃЉрЃљ**.
                        * **рЃБрЃърЃўрЃарЃљрЃбрЃћрЃАрЃЮрЃЉрЃљ:** ­ЪЇј рЃ«рЃўрЃџрЃў, ­ЪЦд рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў, ­ЪїЙ рЃЏрЃЌрЃћрЃџрЃЏрЃљрЃарЃфрЃЋрЃџрЃЮрЃЋрЃљрЃюрЃў (рЃерЃЋрЃарЃўрЃљ, рЃЉрЃарЃўрЃюрЃ»рЃў), ­Ъї▒ рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў, ­ЪљЪ рЃЌрЃћрЃЋрЃќрЃў (рЃќрЃЮрЃЏрЃўрЃћрЃарЃљрЃЊ).
                        * **рЃерЃћрЃќрЃдрЃБрЃЊрЃћрЃЌ:** ­ЪЦЕ рЃгрЃўрЃЌрЃћрЃџрЃў рЃ«рЃЮрЃарЃфрЃў, ­ЪЦЏ рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў.
                        """)
                    elif "B" in blood_abo: # B (III Group)
                        st.write("""
                        **рЃ»рЃњрЃБрЃцрЃў B (III):** рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃўрЃљ **рЃЊрЃљрЃЉрЃљрЃџрЃљрЃюрЃАрЃћрЃЉрЃБрЃџрЃў рЃЊрЃљ рЃЏрЃарЃљрЃЋрЃљрЃџрЃцрЃћрЃарЃЮрЃЋрЃљрЃюрЃў рЃЊрЃўрЃћрЃбрЃљ**.
                        * **рЃБрЃърЃўрЃарЃљрЃбрЃћрЃАрЃЮрЃЉрЃљ:** ­ЪЇЌ рЃЏрЃГрЃџрЃћ рЃ«рЃЮрЃарЃфрЃў, ­ЪљЪ рЃЌрЃћрЃЋрЃќрЃў, ­ЪЦЏ рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў, ­ЪїЙ рЃЏрЃљрЃарЃфрЃЋрЃџрЃћрЃБрЃџрЃў, ­ЪЇј рЃ«рЃўрЃџрЃў, ­ЪЦд рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў.
                        * **рЃерЃћрЃќрЃдрЃБрЃЊрЃћрЃЌ:** ­Ъїй рЃАрЃўрЃЏрЃўрЃюрЃЊрЃў, рЃгрЃўрЃгрЃўрЃЉрЃБрЃарЃљ, рЃљрЃарЃљрЃЦрЃўрЃАрЃў.
                        """)
                    elif "AB" in blood_abo: # AB (IV Group)
                        st.write("""
                        **рЃ»рЃњрЃБрЃцрЃў AB (IV):** рЃћрЃА рЃ»рЃњрЃБрЃцрЃў A рЃЊрЃљ B рЃ»рЃњрЃБрЃцрЃћрЃЉрЃўрЃА рЃюрЃљрЃќрЃљрЃЋрЃўрЃљ. рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃўрЃљ **рЃќрЃЮрЃЏрЃўрЃћрЃарЃў, рЃерЃћрЃарЃћрЃБрЃџрЃў рЃЊрЃўрЃћрЃбрЃљ**.
                        * **рЃБрЃърЃўрЃарЃљрЃбрЃћрЃАрЃЮрЃЉрЃљ:** ­ЪљЪ рЃЌрЃћрЃЋрЃќрЃў, ­ЪЇц рЃќрЃдрЃЋрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў, рЃбрЃЮрЃцрЃБ, ­ЪЦг рЃЏрЃгрЃЋрЃљрЃюрЃћ рЃЉрЃЮрЃАрЃбрЃюрЃћрЃБрЃџрЃў, ­ЪЦЏ рЃарЃФрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў, ­Ъї▒ рЃърЃљрЃарЃЎрЃЮрЃАрЃюрЃћрЃЉрЃў.
                        * **рЃерЃћрЃќрЃдрЃБрЃЊрЃћрЃЌ:** ­ЪЦЕ рЃгрЃўрЃЌрЃћрЃџрЃў рЃ«рЃЮрЃарЃфрЃў (рЃЏрЃфрЃўрЃарЃћ рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃўрЃЌ), ­Ъїй рЃАрЃўрЃЏрЃўрЃюрЃЊрЃў, рЃгрЃўрЃгрЃўрЃЉрЃБрЃарЃљ.
                        """)
                st.info("""
                **рЃерЃћрЃюрЃўрЃерЃЋрЃюрЃљ рЃАрЃўрЃАрЃ«рЃџрЃўрЃА рЃ»рЃњрЃБрЃцрЃќрЃћ:** рЃАрЃўрЃАрЃ«рЃџрЃўрЃА рЃ»рЃњрЃБрЃцрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ рЃЎрЃЋрЃћрЃЉрЃўрЃА рЃЊрЃўрЃћрЃбрЃљ рЃърЃЮрЃърЃБрЃџрЃљрЃарЃБрЃџрЃўрЃљ, рЃЌрЃБрЃЏрЃфрЃљ рЃЏрЃўрЃАрЃў рЃћрЃцрЃћрЃЦрЃбрЃБрЃарЃЮрЃЉрЃљ рЃЏрЃћрЃфрЃюрЃўрЃћрЃарЃБрЃџрЃљрЃЊ рЃАрЃарЃБрЃџрЃљрЃЊ рЃЊрЃљрЃЊрЃљрЃАрЃбрЃБрЃарЃћрЃЉрЃБрЃџрЃў рЃљрЃа рЃљрЃарЃўрЃА.
                """)

            st.markdown("---")
            st.warning("""
            **­Ъџе рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃњрЃљрЃцрЃарЃЌрЃ«рЃўрЃџрЃћрЃЉрЃљ:** рЃћрЃА рЃќрЃЮрЃњрЃљрЃЊрЃў рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃљрЃфрЃўрЃћрЃЉрЃўрЃљ рЃЊрЃљ рЃљрЃа рЃгрЃљрЃарЃЏрЃЮрЃљрЃЊрЃњрЃћрЃюрЃА рЃърЃарЃЮрЃцрЃћрЃАрЃўрЃЮрЃюрЃљрЃџрЃБрЃа рЃАрЃљрЃЏрЃћрЃЊрЃўрЃфрЃўрЃюрЃЮ рЃљрЃю рЃЊрЃўрЃћрЃбрЃЮрЃџрЃЮрЃњрЃўрЃБрЃа рЃЎрЃЮрЃюрЃАрЃБрЃџрЃбрЃљрЃфрЃўрЃљрЃА.
            рЃўрЃюрЃЊрЃўрЃЋрЃўрЃЊрЃБрЃљрЃџрЃБрЃарЃў рЃЎрЃЋрЃћрЃЉрЃўрЃА рЃњрЃћрЃњрЃЏрЃўрЃАрЃЌрЃЋрЃўрЃА рЃЏрЃўрЃЏрЃљрЃарЃЌрЃћрЃЌ рЃџрЃўрЃфрЃћрЃюрЃќрЃўрЃарЃћрЃЉрЃБрЃџ рЃЊрЃўрЃћрЃбрЃЮрЃџрЃЮрЃњрЃА рЃљрЃю рЃћрЃЦрЃўрЃЏрЃА, рЃњрЃљрЃюрЃАрЃљрЃЎрЃБрЃЌрЃарЃћрЃЉрЃўрЃЌ рЃЌрЃБ рЃњрЃљрЃЦрЃЋрЃЌ рЃЦрЃарЃЮрЃюрЃўрЃЎрЃБрЃџрЃў рЃЊрЃљрЃљрЃЋрЃљрЃЊрЃћрЃЉрЃћрЃЉрЃў, рЃљрЃџрЃћрЃарЃњрЃўрЃћрЃЉрЃў рЃљрЃю рЃАрЃърЃћрЃфрЃўрЃљрЃџрЃБрЃарЃў рЃЎрЃЋрЃћрЃЉрЃўрЃЌрЃў рЃАрЃљрЃГрЃўрЃарЃЮрЃћрЃЉрЃћрЃЉрЃў.
            """)

    elif st.session_state.current_page == "­ЪћЇ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃўрЃА рЃФрЃўрЃћрЃЉрЃљ":
        st.header("­ЪћЇ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃўрЃА рЃФрЃўрЃћрЃЉрЃљ")
        st.markdown("рЃљрЃЦ рЃерЃћрЃњрЃўрЃФрЃџрЃўрЃљрЃЌ рЃЏрЃЮрЃФрЃћрЃЉрЃюрЃЮрЃЌ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў рЃЎрЃЮрЃюрЃЎрЃарЃћрЃбрЃБрЃџрЃў рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃфрЃЋрЃћрЃџрЃЮрЃЉрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ рЃЊрЃљ рЃўрЃ«рЃўрЃџрЃЮрЃЌ рЃЏрЃљрЃЌрЃў рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃў рЃўрЃюрЃцрЃЮрЃарЃЏрЃљрЃфрЃўрЃљ.")

        # "рЃЊрЃдрЃўрЃБрЃарЃў рЃЊрЃЮрЃќрЃћрЃЉрЃў (рЃќрЃарЃЊрЃљрЃАрЃарЃБрЃџрЃў)" рЃњрЃљрЃюрЃДрЃЮрЃцрЃўрЃџрЃћрЃЉрЃљ
        st.markdown("**­ЪЊі рЃЊрЃдрЃўрЃБрЃарЃў рЃЊрЃЮрЃќрЃћрЃЉрЃў (рЃќрЃарЃЊрЃљрЃАрЃарЃБрЃџрЃў):**")
        
        col0, col1, col2, col3, col4, col5 = st.columns([2, 3, 3, 3, 3, 1])

        with col0:
            st.button("­ЪћЦ **рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў:** 2000-3000 рЃЎрЃЎрЃљрЃџ", key="dose_calories_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў', 0.0))
        with col1:
            st.button("­ЪћХ **рЃарЃЎрЃўрЃюрЃљ:** 18 рЃЏрЃњ (рЃЦрЃљрЃџрЃћрЃЉрЃў), 8 рЃЏрЃњ (рЃЏрЃљрЃЏрЃљрЃЎрЃљрЃфрЃћрЃЉрЃў)", key="dose_iron_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('рЃарЃЎрЃўрЃюрЃљ', 0.0))
            st.button("­Ъћи **B12:** 2.4 рЃЏрЃЎрЃњ", key="dose_b12_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('B12', 0.0))
            st.button("­ЪЪб **рЃцрЃЮрЃџрЃљрЃбрЃў:** 400 рЃЏрЃЎрЃњ", key="dose_folate_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('рЃцрЃЮрЃџрЃљрЃбрЃў', 0.0))
        with col2:
            st.button("­ЪЪА **C рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў:** 90 рЃЏрЃњ (рЃЏрЃљрЃЏрЃљрЃЎрЃљрЃфрЃћрЃЉрЃў), 75 рЃЏрЃњ (рЃЦрЃљрЃџрЃћрЃЉрЃў)", key="dose_c_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('C рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў', 0.0))
            st.button("­ЪЪа **D рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў:** 600-800 IU", key="dose_d_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('D рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў', 0.0))
            st.button("Рџф **рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў:** 1000-1200 рЃЏрЃњ", key="dose_calcium_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў', 0.0))
        with col3:
            st.button("­ЪЪБ **рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў:** 400-420 рЃЏрЃњ (рЃЏрЃљрЃЏрЃљрЃЎрЃљрЃфрЃћрЃЉрЃў), 310-320 рЃЏрЃњ (рЃЦрЃљрЃџрЃћрЃЉрЃў)", key="dose_magnesium_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў', 0.0))
            st.button("­Ъћх **рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў:** 3500-4700 рЃЏрЃњ", key="dose_potassium_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў', 0.0))
            st.button("РџФ **рЃЌрЃБрЃЌрЃўрЃљ:** 11 рЃЏрЃњ (рЃЏрЃљрЃЏрЃљрЃЎрЃљрЃфрЃћрЃЉрЃў), 8 рЃЏрЃњ (рЃЦрЃљрЃџрЃћрЃЉрЃў)", key="dose_zinc_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('рЃЌрЃБрЃЌрЃўрЃљ', 0.0))
        with col4:
            st.button("Рџф **A рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў:** 700-900 рЃЏрЃЎрЃњ RAE", key="dose_a_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('A рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў', 0.0))
            st.button("­ЪЪц **E рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў:** 15 рЃЏрЃњ", key="dose_e_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('E рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў', 0.0))
            st.button("РџФ **K рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў:** 90-120 рЃЏрЃЎрЃњ", key="dose_k_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('K рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў', 0.0))
            st.button("Рџф **рЃАрЃћрЃџрЃћрЃюрЃў:** 55 рЃЏрЃЎрЃњ", key="dose_selenium_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('рЃАрЃћрЃџрЃћрЃюрЃў', 0.0))
        with col5:
            st.button("­ЪЌЉ№ИЈ рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃљ", key="clear_all_search_page", use_container_width=True, on_click=set_search_and_min_amount, args=('', 0.0))
                
        st.markdown("---")
        
        # рЃФрЃўрЃћрЃЉрЃўрЃА рЃърЃљрЃарЃљрЃЏрЃћрЃбрЃарЃћрЃЉрЃў 
        categories = ['рЃДрЃЋрЃћрЃџрЃљ'] + sorted(df['рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'].unique().tolist())
        selected_category = st.selectbox("рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ:", categories, key="category_filter_search_page")
        
        st.session_state.search_term = st.text_input("рЃЏрЃЮрЃФрЃћрЃЉрЃюрЃћрЃЌ рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃў (рЃЏрЃљрЃњ. рЃарЃЎрЃўрЃюрЃљ, рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў C, рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў):", 
                                                     value=st.session_state.search_term, 
                                                     key="main_search_input_text_field_search_page")
        
        if st.session_state.search_term:
            st.session_state.min_amount = st.number_input(f"рЃЏрЃўрЃюрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ ({st.session_state.search_term}):", 
                                                           min_value=0.0, 
                                                           value=st.session_state.min_amount,
                                                           step=0.1,
                                                           key="min_amount_input_field_search_page")
        
        filtered_df = df.copy()
        
        if selected_category != 'рЃДрЃЋрЃћрЃџрЃљ':
            filtered_df = filtered_df[filtered_df['рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'] == selected_category]
        
        if st.session_state.search_term:
            search_results = search_by_nutrient(filtered_df, st.session_state.search_term, 
                                                st.session_state.min_amount)
            
            if not search_results.empty:
                st.subheader(f"­Ъј» рЃФрЃўрЃћрЃЉрЃўрЃА рЃерЃћрЃЊрЃћрЃњрЃћрЃЉрЃў: '{st.session_state.search_term}'")
                
                daily_dose = get_daily_dose(st.session_state.search_term)
                if daily_dose:
                    st.info(f"­ЪЊі **рЃЊрЃдрЃўрЃБрЃарЃў рЃарЃћрЃЎрЃЮрЃЏрЃћрЃюрЃЊрЃћрЃЉрЃБрЃџрЃў рЃЊрЃЮрЃќрЃљ:** {daily_dose}")
                
                categories_found = search_results['рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'].unique()
                
                for category in sorted(categories_found):
                    with st.expander(f"­ЪЊѓ {category}", expanded=True):
                        category_data = search_results[search_results['рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'] == category]
                        
                        nutrient_col = find_nutrient_column(st.session_state.search_term)
                        if nutrient_col:
                            category_data = category_data.sort_values(nutrient_col, ascending=False)
                            
                            for _, row in category_data.iterrows():
                                col1_display, col2_display = st.columns([3, 1])
                                with col1_display:
                                    st.write(f"**{row['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў']}**")
                                with col2_display:
                                    value = row[nutrient_col]
                                    unit = get_unit(nutrient_col)
                                    if value > 0:
                                        st.write(f"`{value} {unit}`")
                                    else:
                                        st.write("`0`")
            else:
                st.warning(f"рЃљрЃа рЃЏрЃЮрЃўрЃФрЃћрЃЉрЃюрЃљ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў '{st.session_state.search_term}'-рЃўрЃЌ рЃљрЃЏ рЃЎрЃарЃўрЃбрЃћрЃарЃўрЃБрЃЏрЃћрЃЉрЃўрЃЌ.")
        
        else:
            st.subheader("­ЪЊІ рЃДрЃЋрЃћрЃџрЃљ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃћрЃЉрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ")
            
            categories_to_show = filtered_df['рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'].unique()
            
            for category in sorted(categories_to_show):
                with st.expander(f"­ЪЊѓ {category}", expanded=False):
                    category_data = filtered_df[filtered_df['рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'] == category]
                    
                    cols_grid = st.columns(3)  
                    
                    for idx, (_, row) in enumerate(category_data.iterrows()):
                        with cols_grid[idx % 3]:
                            # Ensure all nutrient columns exist before accessing them in the markdown
                            # Add calories to the displayed card
                            nutrition_info = f"""
                            <div class="nutrition-card">
                                <h4 style="margin: 0 0 0.25rem 0; font-size: 1.1em;">{row['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў']}</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.15rem; font-size: 0.85em;"> 
                                    <div>­ЪћЦ рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў: <span class="nutrition-value">{row.get('рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў_рЃЎрЃЎрЃљрЃџ', 0)} рЃЎрЃЎрЃљрЃџ</span></div>
                                    <div>­ЪћХ рЃарЃЎрЃўрЃюрЃљ: <span class="nutrition-value">{row.get('рЃарЃЎрЃўрЃюрЃљ_рЃЏрЃњ', 0)} рЃЏрЃњ</span></div>
                                    <div>­Ъћи B12: <span class="nutrition-value">{row.get('B12_рЃЏрЃЎрЃњ', 0)} рЃЏрЃЎрЃњ</span></div>
                                    <div>­ЪЪб рЃцрЃЮрЃџрЃљрЃбрЃў: <span class="nutrition-value">{row.get('рЃцрЃЮрЃџрЃљрЃбрЃў_рЃЏрЃЎрЃњ', 0)} рЃЏрЃЎрЃњ</span></div>
                                    <div>­ЪЪА C рЃЋрЃўрЃб.: <span class="nutrition-value">{row.get('C_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ', 0)} рЃЏрЃњ</span></div>
                                    <div>­ЪЪа D рЃЋрЃўрЃб.: <span class="nutrition-value">{row.get('D_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_IU', 0)} IU</span></div>
                                    <div>Рџф рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў: <span class="nutrition-value">{row.get('рЃЎрЃљрЃџрЃфрЃўрЃБрЃЏрЃў_рЃЏрЃњ', 0)} рЃЏрЃњ</span></div>
                                    <div>­ЪЪБ рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў: <span class="nutrition-value">{row.get('рЃЏрЃљрЃњрЃюрЃўрЃБрЃЏрЃў_рЃЏрЃњ', 0)} рЃЏрЃњ</span></div>
                                    <div>­Ъћх рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў: <span class="nutrition-value">{row.get('рЃЎрЃљрЃџрЃўрЃБрЃЏрЃў_рЃЏрЃњ', 0)} рЃЏрЃњ</span></div>
                                    <div>РџФ рЃЌрЃБрЃЌрЃўрЃљ: <span class="nutrition-value">{row.get('рЃЌрЃБрЃЌрЃўрЃљ_рЃЏрЃњ', 0)} рЃЏрЃњ</span></div>
                                    <div>Рџф A рЃЋрЃўрЃб.: <span class="nutrition-value">{row.get('A_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ_RAE', 0)} рЃЏрЃЎрЃњ RAE</span></div>
                                    <div>­ЪЪц E рЃЋрЃўрЃб.: <span class="nutrition-value">{row.get('E_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃњ_ATE', 0)} рЃЏрЃњ ATE</span></div>
                                    <div>РџФ K рЃЋрЃўрЃб.: <span class="nutrition-value">{row.get('K_рЃЋрЃўрЃбрЃљрЃЏрЃўрЃюрЃў_рЃЏрЃЎрЃњ', 0)} рЃЏрЃЎрЃњ</span></div>
                                    <div>Рџф рЃАрЃћрЃџрЃћрЃюрЃў: <span class="nutrition-value">{row.get('рЃАрЃћрЃџрЃћрЃюрЃў_рЃЏрЃЎрЃњ', 0)} рЃЏрЃЎрЃњ</span></div>
                                </div>
                            </div>
                            """
                            st.markdown(nutrition_info, unsafe_allow_html=True)

    elif st.session_state.current_page == "­ЪД« рЃЊрЃдрЃўрЃБрЃарЃў рЃюрЃЮрЃарЃЏрЃўрЃА рЃЎрЃљрЃџрЃЎрЃБрЃџрЃљрЃбрЃЮрЃарЃў":
        st.header("­ЪД« рЃЊрЃдрЃўрЃБрЃарЃў рЃюрЃЮрЃарЃЏрЃўрЃА рЃЎрЃљрЃџрЃЎрЃБрЃџрЃљрЃбрЃЮрЃарЃў")
        st.markdown("рЃЊрЃљрЃљрЃЏрЃљрЃбрЃћрЃЌ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў рЃЊрЃљ рЃЏрЃљрЃЌрЃў рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ (рЃњрЃарЃљрЃЏрЃћрЃЉрЃерЃў), рЃарЃљрЃЌрЃљ рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃљрЃџрЃЮрЃЌ рЃЊрЃдрЃўрЃБрЃарЃў рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃ»рЃљрЃЏрЃБрЃарЃў рЃерЃћрЃЏрЃфрЃЋрЃћрЃџрЃЮрЃЉрЃљ.")
        
        gender_calc = st.radio("рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ рЃАрЃЦрЃћрЃАрЃў:", ["рЃЏрЃљрЃЏрЃарЃЮрЃЉрЃўрЃЌрЃў", "рЃЏрЃЊрЃћрЃЊрЃарЃЮрЃЉрЃўрЃЌрЃў"], key="gender_calculator_page", horizontal=True)
        
        product_options = df['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў'].unique().tolist()
        selected_product_name = st.selectbox("рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў:", product_options, key="product_selector_calculator_page")
        
        amount_g = st.number_input("рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ (рЃњрЃарЃљрЃЏрЃћрЃЉрЃерЃў):", min_value=1.0, value=100.0, step=10.0, key="amount_input_calculator_page")
        
        if st.button("РъЋ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃљ", key="add_product_button_calculator_page"):
            if selected_product_name and amount_g > 0:
                found = False
                for i, item in enumerate(st.session_state.selected_products):
                    if item['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў'] == selected_product_name:
                        st.session_state.selected_products[i]['рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ'] = amount_g
                        found = True
                        break
                if not found:
                    st.session_state.selected_products.append({'рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў': selected_product_name, 'рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ': amount_g})
                st.success(f"'{selected_product_name}' рЃЊрЃљрЃћрЃЏрЃљрЃбрЃљ/рЃњрЃљрЃюрЃљрЃ«рЃџрЃЊрЃљ {amount_g} рЃњрЃарЃљрЃЏрЃўрЃЌ.")
            else:
                st.warning("рЃњрЃЌрЃ«рЃЮрЃЋрЃЌ рЃљрЃўрЃарЃЕрЃўрЃЮрЃЌ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў рЃЊрЃљ рЃерЃћрЃўрЃДрЃЋрЃљрЃюрЃЮрЃЌ рЃЊрЃљрЃЊрЃћрЃЉрЃўрЃЌрЃў рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ.")
        
        st.markdown("---")
        
        st.subheader("­ЪЏњ рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃљрЃарЃЕрЃћрЃБрЃџрЃў рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў:")
        if st.session_state.selected_products:
            selected_df = pd.DataFrame(st.session_state.selected_products)
            
            edited_df = st.data_editor(
                selected_df,
                num_rows="dynamic",
                use_container_width=True,
                column_config={
                    "рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў": st.column_config.Column(
                        "рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў",
                        help="рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃўрЃА рЃАрЃљрЃ«рЃћрЃџрЃў",
                        disabled=True,
                    ),
                    "рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ": st.column_config.NumberColumn(
                        "рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ (рЃњрЃарЃљрЃЏрЃћрЃЉрЃерЃў)",
                        help="рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃўрЃА рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ рЃњрЃарЃљрЃЏрЃћрЃЉрЃерЃў",
                        min_value=1.0,
                        step=10.0,
                        format="%f рЃњ",
                    ),
                },
                key="selected_products_editor_calculator_page" # Unique key
            )
            
            st.session_state.selected_products = edited_df.to_dict('records')
            
            if st.button("РЮї рЃАрЃўрЃўрЃА рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃљ", key="clear_selected_products_calculator_page"): # Unique key
                st.session_state.selected_products = []
                st.success("рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃўрЃА рЃАрЃўрЃљ рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃБрЃџрЃўрЃљ.")
                st.rerun()
            
            st.markdown("---")
            
            total_nutrition = calculate_daily_nutrition(st.session_state.selected_products, df)
            
            if total_nutrition:
                st.subheader("­ЪЊі рЃЊрЃдрЃўрЃБрЃарЃў рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃљрЃюрЃљрЃџрЃўрЃќрЃў:")
                recommended_doses = get_recommended_doses(gender_calc)
                display_nutrition_analysis(total_nutrition, recommended_doses)
            else:
                st.info("рЃЊрЃљрЃљрЃЏрЃљрЃбрЃћрЃЌ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў рЃЊрЃдрЃўрЃБрЃарЃў рЃюрЃЮрЃарЃЏрЃўрЃА рЃАрЃљрЃюрЃљрЃ«рЃљрЃЋрЃљрЃЊ.")
        else:
            st.info("рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў рЃљрЃа рЃљрЃарЃўрЃА рЃЊрЃљрЃЏрЃљрЃбрЃћрЃЉрЃБрЃџрЃў.")

    elif st.session_state.current_page == "­ЪЊѕ рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў":
        st.header("­ЪЊѕ рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃАрЃарЃБрЃџрЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў")
        st.markdown("рЃўрЃ«рЃўрЃџрЃћрЃЌ рЃДрЃЋрЃћрЃџрЃљ рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃўрЃА рЃЊрЃљ рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃўрЃА рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃў.")
        
        nutrient_columns = [col for col in df.columns if col not in ['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў', 'рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ']]
        selected_nutrients_to_display = st.multiselect(
            "рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃў рЃАрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃџрЃљрЃЊ:",
            options=nutrient_columns,
            default=st.session_state.nutrients_multiselect_tab4,
            key="nutrients_multiselect_data_page" # Unique key
        )
        
        categories_for_table = ['рЃДрЃЋрЃћрЃџрЃљ'] + sorted(df['рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'].unique().tolist())
        selected_category_for_table = st.selectbox("рЃцрЃўрЃџрЃбрЃарЃў рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ:", categories_for_table, key="category_filter_data_page") # Unique key

        st.button("­ЪЌЉ№ИЈ рЃљрЃарЃЕрЃћрЃБрЃџрЃў рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃљ", on_click=clear_nutrients_multiselect_tab4, key="clear_multiselect_data_page") # Unique key

        display_columns = ['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў', 'рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'] + selected_nutrients_to_display

        filtered_df_tab4 = df.copy()
        if selected_category_for_table != 'рЃДрЃЋрЃћрЃџрЃљ':
            filtered_df_tab4 = filtered_df_tab4[filtered_df_tab4['рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ'] == selected_category_for_table]

        if not selected_nutrients_to_display:
            st.warning("рЃњрЃЌрЃ«рЃЮрЃЋрЃЌ рЃљрЃўрЃарЃЕрЃўрЃЮрЃЌ рЃЏрЃўрЃюрЃўрЃЏрЃБрЃЏ рЃћрЃарЃЌрЃў рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃў рЃЏрЃЮрЃюрЃљрЃфрЃћрЃЏрЃћрЃЉрЃўрЃА рЃАрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃџрЃљрЃЊ.")
        else:
            st.dataframe(filtered_df_tab4[display_columns], use_container_width=True)

    elif st.session_state.current_page == "Рюе рЃЊрЃдрЃўрЃБрЃарЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃерЃћрЃЊрЃњрЃћрЃюрЃљ":
        st.header("Рюе рЃЊрЃдрЃўрЃБрЃарЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃерЃћрЃЊрЃњрЃћрЃюрЃљ")
        st.markdown("рЃљрЃЏ рЃцрЃБрЃюрЃЦрЃфрЃўрЃўрЃА рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃЌ рЃерЃћрЃњрЃўрЃФрЃџрЃўрЃљрЃЌ рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃљ рЃЊрЃдрЃўрЃБрЃарЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃў рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃАрЃЦрЃћрЃАрЃўрЃА рЃЏрЃўрЃ«рЃћрЃЊрЃЋрЃўрЃЌ, рЃарЃЮрЃЏрЃћрЃџрЃўрЃф рЃЊрЃљрЃљрЃЉрЃљрЃџрЃљрЃюрЃАрЃћрЃЉрЃА рЃљрЃБрЃфрЃўрЃџрЃћрЃЉрЃћрЃџ рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃА.")
        
        ration_gender = st.radio("рЃљрЃўрЃарЃЕрЃўрЃћрЃЌ рЃАрЃЦрЃћрЃАрЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃњрЃћрЃюрЃћрЃарЃљрЃфрЃўрЃўрЃАрЃЌрЃЋрЃўрЃА:", ["рЃЏрЃљрЃЏрЃарЃЮрЃЉрЃўрЃЌрЃў", "рЃЏрЃЊрЃћрЃЊрЃарЃЮрЃЉрЃўрЃЌрЃў"], key="ration_gender_selector_ration_page", horizontal=True) # Unique key
        
        st.markdown("---")

        num_ration_items = st.slider("рЃарЃљрЃЏрЃЊрЃћрЃюрЃў рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў рЃњрЃЦрЃЮрЃюрЃЊрЃћрЃЌ рЃарЃљрЃфрЃўрЃЮрЃюрЃерЃў?", min_value=3, max_value=10, value=6, step=1, key="num_ration_items_ration_page") # Unique key
        
        tolerance = st.slider("рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃюрЃЮрЃарЃЏрЃўрЃЊрЃљрЃю рЃњрЃљрЃЊрЃљрЃ«рЃарЃўрЃА рЃбрЃЮрЃџрЃћрЃарЃљрЃюрЃбрЃЮрЃЉрЃљ (%)", min_value=0, max_value=20, value=10, step=1, key="tolerance_ration_page") / 100.0 # Unique key

        if st.button("­ЪЏа№ИЈ рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃњрЃћрЃюрЃћрЃарЃљрЃфрЃўрЃљ", key="generate_ration_button_ration_page"): # Unique key
            initial_product_names = generate_random_ration(df, num_items=num_ration_items)
            
            recommended_doses_for_opt = get_recommended_doses(ration_gender)
            
            # Ensure 'рЃЎрЃљрЃџрЃЮрЃарЃўрЃћрЃЉрЃў_рЃЎрЃЎрЃљрЃџ' is included in nutrient_keys_for_opt
            nutrient_keys_for_opt = [col for col in df.columns if col not in ['рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃў', 'рЃЎрЃљрЃбрЃћрЃњрЃЮрЃарЃўрЃљ']]

            st.session_state.generated_ration = optimize_ration(
                initial_product_names, 
                df, 
                recommended_doses_for_opt, 
                nutrient_keys_for_opt,
                tolerance_percent=tolerance
            )
            
            if st.session_state.generated_ration:
                st.success("­ЪјЅ рЃарЃљрЃфрЃўрЃЮрЃюрЃў рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃЌ рЃњрЃћрЃюрЃћрЃарЃўрЃарЃЊрЃљ!")
            else:
                st.error("РЮї рЃЋрЃћрЃа рЃЏрЃЮрЃ«рЃћрЃарЃ«рЃЊрЃљ рЃЮрЃърЃбрЃўрЃЏрЃљрЃџрЃБрЃарЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃљ рЃЏрЃЮрЃфрЃћрЃЏрЃБрЃџрЃў рЃЎрЃарЃўрЃбрЃћрЃарЃўрЃБрЃЏрЃћрЃЉрЃўрЃЌ. рЃАрЃфрЃљрЃЊрЃћрЃЌ рЃАрЃ«рЃЋрЃљ рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃўрЃА рЃърЃарЃЮрЃЊрЃБрЃЦрЃбрЃћрЃЉрЃў рЃљрЃю рЃерЃћрЃфрЃЋрЃљрЃџрЃћрЃЌ рЃбрЃЮрЃџрЃћрЃарЃљрЃюрЃбрЃЮрЃЉрЃљ.")

        if st.session_state.generated_ration:
            st.subheader("­ЪЊІ рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў рЃЊрЃдрЃўрЃБрЃарЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃў:")
            generated_ration_df = pd.DataFrame(st.session_state.generated_ration)
            st.dataframe(generated_ration_df, use_container_width=True)

            total_nutrition_generated = calculate_daily_nutrition(st.session_state.generated_ration, df)
            if total_nutrition_generated:
                st.subheader("­ЪЊі рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃюрЃБрЃбрЃарЃўрЃћрЃюрЃбрЃћрЃЉрЃўрЃА рЃљрЃюрЃљрЃџрЃўрЃќрЃў:")
                recommended_doses_for_ration = get_recommended_doses(ration_gender)
                display_nutrition_analysis(total_nutrition_generated, recommended_doses_for_ration)
            
            if st.button("­ЪЌЉ№ИЈ рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃљ", key="clear_generated_ration_ration_page"): # Unique key
                st.session_state.generated_ration = []
                st.success("рЃњрЃћрЃюрЃћрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃў рЃњрЃљрЃАрЃБрЃцрЃЌрЃљрЃЋрЃћрЃЉрЃБрЃџрЃўрЃљ.")
                st.rerun()

        else:
            st.info("рЃЊрЃљрЃљрЃГрЃўрЃарЃћрЃЌ 'рЃарЃљрЃфрЃўрЃЮрЃюрЃўрЃА рЃњрЃћрЃюрЃћрЃарЃљрЃфрЃўрЃљ' рЃдрЃўрЃџрЃљрЃЎрЃА, рЃарЃљрЃЌрЃљ рЃерЃћрЃЦрЃЏрЃюрЃљрЃЌ рЃЌрЃЦрЃЋрЃћрЃюрЃў рЃЊрЃдрЃўрЃБрЃарЃў рЃарЃљрЃфрЃўрЃЮрЃюрЃў.")

if __name__ == "__main__":
    main()
